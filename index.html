<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize - Size Finder & Body Tracker!</title>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer {
      flex: 1;
    }
    
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header {
      margin-bottom: 40px;
    }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-tile:active {
      transform: translateY(-2px);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover {
      color: var(--brand);
    }
    
    .nav-item.active {
      color: var(--brand);
    }

    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: block;
    }

    .system-status {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 2px solid var(--border);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-online { background: var(--green); }
    .status-loading { background: var(--orange); }
    .status-offline { background: var(--muted); }

    .btn {
      padding: 12px 24px;
      background: var(--brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 8px;
      font-weight: bold;
      font-size: 14px;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize</div>
      
      <div class="pill-group">
        <button class="pill active" data-type="standard">Std</button>
        <button class="pill" data-type="petite">Petite</button>
        <button class="pill" data-type="tall">Tall</button>
        <button class="pill" data-type="plus">Plus</button>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize</h1>
        <p class="subtitle">Your personal size finder and body tracker with AI-powered sizing!</p>
      </div>
      
      <div class="system-status">
        <div class="status-indicator">
          <div class="status-dot status-loading" id="system-status-dot"></div>
          <span id="system-status-text">Initializing AI system...</span>
        </div>
      </div>
      
      <div class="region-grid">
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">üá¨üáß</span>
          <h3 class="region-name">UK</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">üá™üá∫</span>
          <h3 class="region-name">EU</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">üá∫üá∏</span>
          <h3 class="region-name">US</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">üá®üá¶</span>
          <h3 class="region-name">CA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Test Screen -->
  <div id="ai-test-screen" class="screen">
    <div class="main-container" style="padding: 40px 20px;">
      <h1 class="title" style="font-size: 36px;">ü§ñ AI Engine Test</h1>
      <p class="subtitle" id="ai-status">Testing AI system capabilities...</p>
      
      <div style="max-width: 800px; margin: 20px auto; text-align: left;">
        <div id="ai-info" style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--border); margin-bottom: 20px;"></div>
        
        <div style="text-align: center; margin: 30px 0;">
          <button class="btn" onclick="testAISystem()" style="background: var(--green); margin-right: 10px;">üéØ Test Size Finder</button>
          <button class="btn" onclick="testGetAllSizes()" style="background: var(--blue); margin-right: 10px;">üìä Test All Sizes</button>
          <button class="btn" onclick="testMeasurements()" style="background: var(--orange);">üìè Test Measurements</button>
        </div>
        
        <div id="ai-results" style="margin-top: 30px;"></div>
      </div>
      
      <button onclick="goHome()" class="btn" style="margin-top: 30px;">üè† Go Home</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="goHome()">Home</button>
    <button class="nav-item" onclick="goToScreen('ai-test-screen')">Test AI</button>
    <button class="nav-item" onclick="alert('MiStats coming soon!')">MiStats</button>
    <button class="nav-item" onclick="alert('Settings coming soon!')">Settings</button>
    <button class="nav-item" onclick="alert('Help coming soon!')">Help</button>
  </div>

<script>
// Global variables
let currentScreen = 'home';
let currentProfile = 'Emma Morris';
let miSizeSystem = null;

// Profile Data
let profileData = {
  'Emma Morris': {
    name: 'Emma Morris',
    measurements: { weight: 80, chest: 36, waist: 34, hips: 38, shoulders: 38, arms: 28 }
  }
};

// Brand Database
const BRAND_SIZE_DATABASE = {
  'ASOS': {
    name: 'ASOS',
    categories: {
      "Women's Tops": {
        '12': { bust: 36, waist: 30, hips: 38 },
        '14': { bust: 38, waist: 32, hips: 40 },
        '16': { bust: 40, waist: 34, hips: 42 },
        '18': { bust: 42, waist: 36, hips: 44 }
      }
    }
  },
  'Zara': {
    name: 'Zara',
    categories: {
      "Women's Tops": {
        'M': { bust: 36, waist: 30, hips: 38 },
        'L': { bust: 38, waist: 32, hips: 40 },
        'XL': { bust: 40, waist: 34, hips: 42 }
      }
    }
  }
};

console.log('üöÄ Starting MiSize AI Test...');

// AI ENGINE CLASSES
class SizeMatchingEngine {
  constructor() {
    this.brandDatabase = BRAND_SIZE_DATABASE;
    this.userMeasurements = {};
    console.log('‚úÖ SizeMatchingEngine created');
  }

  setUserMeasurements(measurements) {
    this.userMeasurements = {
      bust: parseFloat(measurements.bust) || 0,
      waist: parseFloat(measurements.waist) || 0,
      hips: parseFloat(measurements.hips) || 0,
      unit: measurements.unit || 'inch'
    };
    console.log('üìè Measurements set:', this.userMeasurements);
  }

  findBestSizeForBrand(brandName, category, fitPreference = 'standard') {
    console.log(`üîç Finding size for ${brandName} - ${category}`);
    
    const brandData = this.brandDatabase[brandName];
    if (!brandData || !brandData.categories || !brandData.categories[category]) {
      console.warn(`‚ùå No data for ${brandName} - ${category}`);
      return null;
    }

    const sizes = brandData.categories[category];
    let bestSize = null;
    let bestScore = -1;

    Object.entries(sizes).forEach(([size, measurements]) => {
      const score = this.calculateFitScore(measurements);
      console.log(`Size ${size} score: ${score}`);
      
      if (score > bestScore) {
        bestScore = score;
        bestSize = size;
      }
    });

    const confidence = Math.round(bestScore);
    console.log(`‚úÖ Best size: ${bestSize} (${confidence}% confidence)`);

    return {
      brand: brandName,
      recommendedSize: bestSize,
      confidence: confidence,
      category: category
    };
  }

  calculateFitScore(sizeMeasurements) {
    const user = this.userMeasurements;
    let totalScore = 0;
    let count = 0;

    ['bust', 'waist', 'hips'].forEach(measurement => {
      if (user[measurement] && sizeMeasurements[measurement]) {
        const diff = Math.abs(user[measurement] - sizeMeasurements[measurement]);
        const score = Math.max(0, 100 - (diff * 15));
        totalScore += score;
        count++;
      }
    });

    return count > 0 ? totalScore / count : 0;
  }

  getAllBrandSizes(category) {
    const results = [];
    
    Object.keys(this.brandDatabase).forEach(brandName => {
      const result = this.findBestSizeForBrand(brandName, category);
      if (result && result.confidence >= 50) {
        results.push(result);
      }
    });

    return results.sort((a, b) => b.confidence - a.confidence);
  }
}

class MiSizeAISystem {
  constructor() {
    this.sizeEngine = new SizeMatchingEngine();
    this.isInitialized = false;
    console.log('üß† MiSizeAISystem created');
  }

  async initialize() {
    console.log('üîÑ Initializing AI system...');
    this.updateSystemStatus('loading', 'Initializing AI sizing system...');
    
    await this.sleep(1500);
    
    this.updateUserMeasurements();
    this.isInitialized = true;
    this.updateSystemStatus('online', 'ü§ñ AI sizing system active');
    
    console.log('‚úÖ AI system initialized');
    return true;
  }

  updateUserMeasurements() {
    const profile = profileData[currentProfile];
    if (profile && profile.measurements) {
      this.sizeEngine.setUserMeasurements({
        bust: profile.measurements.chest || 36,
        waist: profile.measurements.waist || 34,
        hips: profile.measurements.hips || 38,
        unit: 'inch'
      });
      console.log('‚úÖ User measurements loaded from profile');
    }
  }

  async getAccurateSize(brand, category, fitPreference = 'standard') {
    if (!this.isInitialized) throw new Error('AI system not initialized');
    
    const result = this.sizeEngine.findBestSizeForBrand(brand, category, fitPreference);
    
    if (!result) {
      return { success: false, message: `No size data for ${brand} - ${category}` };
    }

    return {
      success: true,
      ...result
    };
  }

  async getAllMySizes() {
    if (!this.isInitialized) throw new Error('AI system not initialized');
    
    const results = {};
    results["Women's Tops"] = this.sizeEngine.getAllBrandSizes("Women's Tops");
    
    return results;
  }

  updateSystemStatus(status, message) {
    const statusDot = document.getElementById('system-status-dot');
    const statusText = document.getElementById('system-status-text');
    
    if (statusDot) statusDot.className = `status-dot status-${status}`;
    if (statusText) statusText.textContent = message;
  }

  sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// NAVIGATION
function goToScreen(screenId) {
  console.log('üì± Navigating to:', screenId);
  
  document.querySelectorAll('.screen').forEach(screen => {
    screen.classList.remove('active');
  });
  
  const targetScreen = document.getElementById(screenId);
  if (targetScreen) {
    targetScreen.classList.add('active');
    currentScreen = screenId;
    
    if (screenId === 'ai-test-screen') {
      displayAITestInfo();
    }
    
    updateNavigation();
  }
}

function goHome() { goToScreen('home'); }
function enterHub(region) { 
  if (region === 'UK') {
    goToScreen('ai-test-screen'); 
  } else {
    alert(region + ' coming soon!');
  }
}

function updateNavigation() {
  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
  
  if (currentScreen === 'home') {
    document.querySelector('.nav-item[onclick="goHome()"]')?.classList.add('active');
  } else if (currentScreen === 'ai-test-screen') {
    document.querySelector('.nav-item[onclick="goToScreen(\'ai-test-screen\')"]')?.classList.add('active');
  }
}

// AI TEST FUNCTIONS
function displayAITestInfo() {
  const status = document.getElementById('ai-status');
  const info = document.getElementById('ai-info');
  
  const profile = profileData[currentProfile];
  const aiStatus = miSizeSystem ? (miSizeSystem.isInitialized ? '‚úÖ Ready' : '‚è≥ Initializing') : '‚ùå Not loaded';
  
  status.textContent = `AI System: ${aiStatus} | Profile: ${profile.name}`;
  
  info.innerHTML = `
    <h3 style="color: var(--brand); margin-top: 0;">ü§ñ AI System Status</h3>
    <p><strong>Status:</strong> ${aiStatus}</p>
    <p><strong>Current Profile:</strong> ${profile.name}</p>
    <p><strong>Measurements:</strong> ${profile.measurements.chest}" bust, ${profile.measurements.waist}" waist, ${profile.measurements.hips}" hips</p>
    <p><strong>Available Brands:</strong> ${Object.keys(BRAND_SIZE_DATABASE).length} loaded (ASOS, Zara)</p>
    
    <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
      <strong>üß™ Test Options:</strong>
      <ul style="margin: 8px 0; padding-left: 20px;">
        <li><strong>Size Finder:</strong> Tests finding your best size for ASOS Women's Tops</li>
        <li><strong>All Sizes:</strong> Tests getting sizes across all brands</li>
        <li><strong>Measurements:</strong> Shows how your measurements compare to size charts</li>
      </ul>
    </div>
  `;
}

async function testAISystem() {
  console.log('üß™ Testing AI Size Finder...');
  const results = document.getElementById('ai-results');
  results.innerHTML = '<div style="text-align: center; padding: 20px;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid var(--muted); border-top: 3px solid var(--brand); border-radius: 50%; animation: spin 1s linear infinite;"></div><p>Testing AI...</p></div>';
  
  try {
    if (!miSizeSystem.isInitialized) {
      await miSizeSystem.initialize();
    }
    
    const result = await miSizeSystem.getAccurateSize('ASOS', "Women's Tops");
    
    if (result.success) {
      results.innerHTML = `
        <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--green);">
          <h3 style="color: var(--green); margin-top: 0;">‚úÖ AI Test Successful!</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
              <p><strong>Brand:</strong> ${result.brand}</p>
              <p><strong>Category:</strong> ${result.category}</p>
              <p><strong>Your measurements:</strong> 36" bust, 34" waist, 38" hips</p>
            </div>
            <div style="text-align: center;">
              <div style="background: var(--brand); color: white; padding: 12px; border-radius: 8px; font-size: 18px; font-weight: bold;">
                Size ${result.recommendedSize}
              </div>
              <p style="color: var(--green); font-weight: bold; margin-top: 8px;">${result.confidence}% Confidence</p>
            </div>
          </div>
        </div>
      `;
    } else {
      results.innerHTML = `
        <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
          <h3 style="color: var(--orange);">‚ö†Ô∏è Test Issue</h3>
          <p>${result.message}</p>
        </div>
      `;
    }
  } catch (error) {
    results.innerHTML = `
      <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
        <h3 style="color: var(--orange);">‚ùå Test Failed</h3>
        <p>${error.message}</p>
      </div>
    `;
  }
}

async function testGetAllSizes() {
  console.log('üß™ Testing Get All Sizes...');
  const results = document.getElementById('ai-results');
  results.innerHTML = '<div style="text-align: center; padding: 20px;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid var(--muted); border-top: 3px solid var(--brand); border-radius: 50%; animation: spin 1s linear infinite;"></div><p>Getting all sizes...</p></div>';
  
  try {
    if (!miSizeSystem.isInitialized) {
      await miSizeSystem.initialize();
    }
    
    const allSizes = await miSizeSystem.getAllMySizes();
    
    let html = `<div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--green);">
      <h3 style="color: var(--green); margin-top: 0;">‚úÖ All Sizes Test Successful!</h3>`;
    
    Object.entries(allSizes).forEach(([category, brands]) => {
      html += `<h4 style="color: var(--brand);">${category}:</h4><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">`;
      
      brands.forEach(brand => {
        const confidenceColor = brand.confidence >= 80 ? 'var(--green)' : brand.confidence >= 60 ? 'var(--blue)' : 'var(--orange)';
        html += `
          <div style="background: var(--bg); padding: 12px; border-radius: 8px; border: 1px solid ${confidenceColor};">
            <strong>${brand.brand}</strong><br>
            Size: <span style="color: ${confidenceColor}; font-weight: bold;">${brand.recommendedSize}</span><br>
            <small>${brand.confidence}% match</small>
          </div>
        `;
      });
      
      html += `</div>`;
    });
    
    html += `</div>`;
    results.innerHTML = html;
    
  } catch (error) {
    results.innerHTML = `
      <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
        <h3 style="color: var(--orange);">‚ùå Test Failed</h3>
        <p>${error.message}</p>
      </div>
    `;
  }
}

function testMeasurements() {
  const results = document.getElementById('ai-results');
  const profile = profileData[currentProfile];
  
  results.innerHTML = `
    <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--blue);">
      <h3 style="color: var(--blue); margin-top: 0;">üìè Measurement Analysis</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
        <div style="background: var(--bg); padding: 12px; border-radius: 8px; text-align: center;">
          <strong>Bust/Chest</strong><br>
          <span style="font-size: 24px; color: var(--brand);">${profile.measurements.chest}"</span>
        </div>
        <div style="background: var(--bg); padding: 12px; border-radius: 8px; text-align: center;">
          <strong>Waist</strong><br>
          <span style="font-size: 24px; color: var(--brand);">${profile.measurements.waist}"</span>
        </div>
        <div style="background: var(--bg); padding: 12px; border-radius: 8px; text-align: center;">
          <strong>Hips</strong><br>
          <span style="font-size: 24px; color: var(--brand);">${profile.measurements.hips}"</span>
        </div>
      </div>
      
      <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px;">
        <p><strong>Size Comparison:</strong></p>
        <ul style="margin: 8px 0; padding-left: 20px;">
          <li><strong>ASOS Size 16:</strong> 40" bust, 34" waist, 42" hips</li>
          <li><strong>Your measurements:</strong> ${profile.measurements.chest}" bust, ${profile.measurements.waist}" waist, ${profile.measurements.hips}" hips</li>
          <li><strong>Best match:</strong> Close to size 16 waist, smaller bust/hips</li>
        </ul>
      </div>
    </div>
  `;
}

// Initialize
async function initApp() {
  console.log('üîÑ Initializing AI test app...');
  
  // Set up pill controls
  document.querySelectorAll('.pill').forEach(pill => {
    pill.addEventListener('click', function() {
      const group = this.parentElement;
      group.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
      this.classList.add('active');
    });
  });
  
  // Initialize AI
  miSizeSystem = new MiSizeAISystem();
  await miSizeSystem.initialize();
  
  updateNavigation();
  console.log('‚úÖ AI test app ready');
}

// Add CSS animation
const style = document.createElement('style');
style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
document.head.appendChild(style);

document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
