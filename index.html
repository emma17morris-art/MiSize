<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize - Size Finder & Body Tracker</title>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer {
      flex: 1;
    }
    
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header {
      margin-bottom: 40px;
    }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-tile:active {
      transform: translateY(-2px);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover {
      color: var(--brand);
    }
    
    .nav-item.active {
      color: var(--brand);
    }

    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: block;
    }

    .hub-container {
      padding: 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .hub-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .hub-flag {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .hub-title {
      font-size: 36px;
      font-weight: 900;
      margin: 0 0 8px;
    }

    .hub-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin: 0;
    }

    .hub-tiles {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tiles-5 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tiles-5 .hub-tile:last-child {
      grid-column: span 2;
    }

    .hub-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      text-align: center;
      color: #fff;
      font-size: 18px;
      font-weight: 800;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hub-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .btn {
      flex: 1;
      padding: 16px 24px;
      border: 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-secondary {
      background: var(--card);
      color: var(--text);
      border: 2px solid var(--border);
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    /* Settings Specific Styles */
    .settings-section {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
    }

    .settings-section h3 {
      color: var(--brand);
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 16px;
    }

    .pill-settings-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .settings-pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 12px;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-pill.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .profile-tile {
      background: var(--blue);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      color: #fff;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .profile-tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(29, 78, 216, 0.3);
    }

    .profile-tiles-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .profile-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s;
    }

    .profile-card:hover {
      border-color: var(--brand);
    }

    .profile-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .profile-details {
      font-size: 14px;
      color: var(--muted);
    }

    .measurement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .measurement-bubble {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s;
    }

    .measurement-bubble:hover {
      border-color: var(--brand);
    }

    .measurement-bubble h4 {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .measurement-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      text-align: center;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize</div>
      
      <div class="pill-group">
        <button class="pill active" data-type="standard">Std</button>
        <button class="pill" data-type="petite">Petite</button>
        <button class="pill" data-type="tall">Tall</button>
        <button class="pill" data-type="plus">Plus</button>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize</h1>
        <p class="subtitle">Your personal size finder and body tracker</p>
      </div>
      
      <div class="region-grid">
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">🇬🇧</span>
          <h3 class="region-name">UK</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('EU')">
          <span class="region-flag">🇪🇺</span>
          <h3 class="region-name">EU</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('US')">
          <span class="region-flag">🇺🇸</span>
          <h3 class="region-name">US</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('CA')">
          <span class="region-flag">🇨🇦</span>
          <h3 class="region-name">CA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- UK Hub -->
  <div id="uk-hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">🇬🇧</div>
        <h2 class="hub-title">UK Hub</h2>
        <p class="hub-subtitle">United Kingdom sizing & tracking</p>
      </div>
      
      <div class="hub-tiles-5">
        <div class="hub-tile" onclick="alert('Size Finder coming soon!')">Size Finder</div>
        <div class="hub-tile" onclick="alert('My Sizes coming soon!')">My Sizes</div>
        <div class="hub-tile" onclick="alert('Brand Notes coming soon!')">Brand Notes</div>
        <div class="hub-tile" onclick="alert('History coming soon!')">History</div>
        <div class="hub-tile" onclick="goToScreen('uk-settings')">Settings</div>
      </div>
    </div>
  </div>

  <!-- UK Settings Main Page -->
  <div id="uk-settings" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Settings</h2>
        <p class="hub-subtitle">Manage your profiles and preferences</p>
      </div>

      <!-- Profile Management Section -->
      <div class="settings-section">
        <h3>👤 Profile Management</h3>
        <p style="margin-bottom: 16px; color: var(--muted);">Create and manage user profiles</p>
        
        <div class="profile-tiles-group">
          <div class="profile-tile" onclick="goToScreen('create-profile')">
            Create Profile
          </div>
          <div class="profile-tile" onclick="goToScreen('saved-profiles')">
            Saved Profiles
          </div>
          <div class="profile-tile" onclick="goToScreen('edit-profiles')">
            Edit Profiles
          </div>
        </div>
      </div>

      <!-- Measurements Section -->
      <div class="settings-section">
        <h3>📏 Current Profile Measurements</h3>
        <p style="margin-bottom: 16px; color: var(--muted);">Track body measurements for accurate sizing</p>

        <div class="measurement-grid">
          <div class="measurement-bubble">
            <h4>Weight</h4>
            <input type="number" class="measurement-input" id="weight" placeholder="62" />
          </div>
          <div class="measurement-bubble">
            <h4>Chest/Bust</h4>
            <input type="number" class="measurement-input" id="chest" placeholder="86" />
          </div>
          <div class="measurement-bubble">
            <h4>Waist</h4>
            <input type="number" class="measurement-input" id="waist" placeholder="68" />
          </div>
          <div class="measurement-bubble">
            <h4>Hips</h4>
            <input type="number" class="measurement-input" id="hips" placeholder="92" />
          </div>
          <div class="measurement-bubble">
            <h4>Shoulders</h4>
            <input type="number" class="measurement-input" id="shoulders" placeholder="38" />
          </div>
          <div class="measurement-bubble">
            <h4>Arms</h4>
            <input type="number" class="measurement-input" id="arms" placeholder="28" />
          </div>
        </div>

        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="saveMeasurements()">Save Measurements</button>
      </div>

      <!-- Region Settings -->
      <div class="settings-section">
        <h3>🌍 Change Region</h3>
        <p style="margin-bottom: 16px; color: var(--muted);">Select your primary shopping region</p>
        
        <div class="pill-settings-group">
          <button class="settings-pill active" data-region="uk">🇬🇧 UK</button>
          <button class="settings-pill" data-region="eu">🇪🇺 EU</button>
          <button class="settings-pill" data-region="us">🇺🇸 US</button>
          <button class="settings-pill" data-region="ca">🇨🇦 CA</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Profile Screen -->
  <div id="create-profile" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">Create New Profile</h2>
        <p class="hub-subtitle">Set up a new user profile</p>
      </div>

      <div class="form-container">
        <div class="form-group">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="create-profile-name" placeholder="Enter profile name" />
        </div>
        
        <div class="form-group">
          <label class="form-label">Date of Birth</label>
          <input type="date" class="form-input" id="create-date-birth" />
        </div>

        <div class="form-group">
          <label class="form-label">Gender</label>
          <div class="pill-settings-group">
            <button class="settings-pill" data-gender="male">Male</button>
            <button class="settings-pill" data-gender="female">Female</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Body Frame</label>
          <div class="pill-settings-group">
            <button class="settings-pill" data-frame="small">Small</button>
            <button class="settings-pill active" data-frame="medium">Medium</button>
            <button class="settings-pill" data-frame="large">Large</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Starting Date</label>
          <input type="date" class="form-input" id="create-start-date" />
        </div>

        <div class="form-group">
          <label class="form-label">Starting Weight</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="number" class="form-input" id="create-start-weight" placeholder="Enter weight" style="flex: 1;" />
            <div class="pill-settings-group" style="margin: 0;">
              <button class="settings-pill active" data-weight-unit="kg">kg</button>
              <button class="settings-pill" data-weight-unit="lbs">lbs</button>
              <button class="settings-pill" data-weight-unit="stone">stone</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Starting Height</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="text" class="form-input" id="create-start-height" placeholder="Enter height" style="flex: 1;" />
            <div class="pill-settings-group" style="margin: 0;">
              <button class="settings-pill active" data-height-unit="cm">cm</button>
              <button class="settings-pill" data-height-unit="inch">inch</button>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" onclick="saveNewProfile()">Create Profile</button>
          <button class="btn btn-secondary" onclick="goBack()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Saved Profiles Screen -->
  <div id="saved-profiles" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">Saved Profiles</h2>
        <p class="hub-subtitle">View all your saved profiles</p>
      </div>

      <div id="profiles-list">
        <!-- Profiles will be populated here -->
      </div>
    </div>
  </div>

  <!-- Edit Profiles Screen -->
  <div id="edit-profiles" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">Edit Profiles</h2>
        <p class="hub-subtitle">Select a profile to edit</p>
      </div>

      <div id="edit-profiles-list">
        <!-- Editable profiles will be populated here -->
      </div>
    </div>
  </div>

  <!-- Edit Profile Form Screen -->
  <div id="edit-profile-form" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">Edit Profile</h2>
        <p class="hub-subtitle">Update profile information</p>
      </div>

      <div class="form-container">
        <div class="form-group">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="edit-profile-name" />
        </div>
        
        <div class="form-group">
          <label class="form-label">Date of Birth</label>
          <input type="date" class="form-input" id="edit-date-birth" />
        </div>

        <div class="form-group">
          <label class="form-label">Gender</label>
          <div class="pill-settings-group">
            <button class="settings-pill" data-gender="male" id="edit-gender-male">Male</button>
            <button class="settings-pill" data-gender="female" id="edit-gender-female">Female</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Body Frame</label>
          <div class="pill-settings-group">
            <button class="settings-pill" data-frame="small" id="edit-frame-small">Small</button>
            <button class="settings-pill" data-frame="medium" id="edit-frame-medium">Medium</button>
            <button class="settings-pill" data-frame="large" id="edit-frame-large">Large</button>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Starting Date</label>
          <input type="date" class="form-input" id="edit-start-date" />
        </div>

        <div class="form-group">
          <label class="form-label">Starting Weight</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="number" class="form-input" id="edit-start-weight" style="flex: 1;" />
            <div class="pill-settings-group" style="margin: 0;">
              <button class="settings-pill" data-weight-unit="kg" id="edit-weight-kg">kg</button>
              <button class="settings-pill" data-weight-unit="lbs" id="edit-weight-lbs">lbs</button>
              <button class="settings-pill" data-weight-unit="stone" id="edit-weight-stone">stone</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Starting Height</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="text" class="form-input" id="edit-start-height" style="flex: 1;" />
            <div class="pill-settings-group" style="margin: 0;">
              <button class="settings-pill" data-height-unit="cm" id="edit-height-cm">cm</button>
              <button class="settings-pill" data-height-unit="inch" id="edit-height-inch">inch</button>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" onclick="updateProfile()">Update Profile</button>
          <button class="btn btn-secondary" onclick="goBack()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="goHome()">Home</button>
    <button class="nav-item" onclick="alert('MiStats coming soon!')">MiStats</button>
    <button class="nav-item" onclick="goToSettings()">Settings</button>
    <button class="nav-item" onclick="alert('Help coming soon!')">Help</button>
    <button class="nav-item" onclick="goBack()">Back</button>
  </div>

  <script>
    // Global variables
    let currentScreen = 'home';
    let navigationHistory = [];
    let selectedBodyType = 'standard';
    let selectedUnit = 'cm';
    let currentProfile = null;
    let editingProfile = null;
    
    // Profile data structure
    let profileData = {
      'Emma Thompson': {
        name: 'Emma Thompson',
        dateOfBirth: '1990-05-15',
        gender: 'female',
        bodyFrame: 'medium',
        startingDate: '2024-01-01',
        startingWeight: { value: 65, unit: 'kg' },
        startingHeight: { value: 168, unit: 'cm' },
        measurements: { weight: 62, chest: 86, waist: 68, hips: 92, shoulders: 38, arms: 28 }
      },
      'John Doe': {
        name: 'John Doe',
        dateOfBirth: '1985-08-20',
        gender: 'male',
        bodyFrame: 'large',
        startingDate: '2024-02-01',
        startingWeight: { value: 80, unit: 'kg' },
        startingHeight: { value: 180, unit: 'cm' },
        measurements: { weight: 75, chest: 102, waist: 84, hips: 96, shoulders: 46, arms: 32 }
      }
    };

    // Navigation functions
    function enterHub(region) {
      const hubScreen = region.toLowerCase() + '-hub';
      goToScreen(hubScreen);
    }
    
    function goToScreen(screenId) {
      if (currentScreen !== screenId) {
        navigationHistory.push(currentScreen);
      }
      
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      const targetScreen = document.getElementById(screenId);
      if (targetScreen) {
        targetScreen.classList.add('active');
        currentScreen = screenId;
        updateScreenData(screenId);
        updateNavigation();
      }
    }

    function updateScreenData(screenId) {
      if (screenId === 'saved-profiles') {
        loadSavedProfiles();
      } else if (screenId === 'edit-profiles') {
        loadEditableProfiles();
      }
    }

    function goHome() {
      navigationHistory = [];
      goToScreen('home');
    }

    function goToSettings() {
      goToScreen('uk-settings');
    }

    function goBack() {
      if (navigationHistory.length > 0) {
        const previousScreen = navigationHistory.pop();
        
        document.querySelectorAll('.screen').forEach(screen => {
          screen.classList.remove('active');
        });
        
        const targetScreen = document.getElementById(previousScreen);
        if (targetScreen) {
          targetScreen.classList.add('active');
          currentScreen = previousScreen;
          updateScreenData(previousScreen);
          updateNavigation();
        }
      }
    }

    function updateNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (currentScreen === 'home') {
        document.querySelector('.nav-item[onclick="goHome()"]')?.classList.add('active');
      }
    }

    // Profile management functions
    function saveNewProfile() {
      const name = document.getElementById('create-profile-name')?.value;
      const dateOfBirth = document.getElementById('create-date-birth')?.value;
      const startDate = document.getElementById('create-start-date')?.value;
      const startWeight = document.getElementById('create-start-weight')?.value;
      const startHeight = document.getElementById('create-start-height')?.value;
      
      // Get selected values from pills
      const gender = document.querySelector('[data-gender].active')?.dataset.gender;
      const frame = document.querySelector('[data-frame].active')?.dataset.frame;
      const weightUnit = document.querySelector('[data-weight-unit].active')?.dataset.weightUnit;
      const heightUnit = document.querySelector('[data-height-unit].active')?.dataset.heightUnit;
      
      if (!name || !dateOfBirth || !gender || !frame || !startDate || !startWeight || !startHeight) {
        alert('Please fill in all fields');
        return;
      }
      
      const newProfile = {
        name: name,
        dateOfBirth: dateOfBirth,
        gender: gender,
        bodyFrame: frame,
        startingDate: startDate,
        startingWeight: { value: parseFloat(startWeight), unit: weightUnit },
        startingHeight: { value: parseFloat(startHeight), unit: heightUnit },
        measurements: { weight: null, chest: null, waist: null, hips: null, shoulders: null, arms: null }
      };
      
      profileData[name] = newProfile;
      alert('Profile created successfully!');
      
      // Clear form
      clearCreateForm();
      goToScreen('uk-settings');
    }

    function clearCreateForm() {
      document.getElementById('create-profile-name').value = '';
      document.getElementById('create-date-birth').value = '';
      document.getElementById('create-start-date').value = '';
      document.getElementById('create-start-weight').value = '';
      document.getElementById('create-start-height').value = '';
      
      // Reset pills to default
      document.querySelectorAll('[data-gender]').forEach(pill => pill.classList.remove('active'));
      document.querySelectorAll('[data-frame]').forEach(pill => pill.classList.remove('active'));
      document.querySelector('[data-frame="medium"]')?.classList.add('active');
      document.querySelectorAll('[data-weight-unit]').forEach(pill => pill.classList.remove('active'));
      document.querySelector('[data-weight-unit="kg"]')?.classList.add('active');
      document.querySelectorAll('[data-height-unit]').forEach(pill => pill.classList.remove('active'));
      document.querySelector('[data-height-unit="cm"]')?.classList.add('active');
    }

    function loadSavedProfiles() {
      const container = document.getElementById('profiles-list');
      if (!container) return;
      
      container.innerHTML = Object.entries(profileData).map(([key, profile]) => `
        <div class="profile-card">
          <div class="profile-name">${profile.name}</div>
          <div class="profile-details">
            <strong>Gender:</strong> ${profile.gender.charAt(0).toUpperCase() + profile.gender.slice(1)}<br>
            <strong>Body Frame:</strong> ${profile.bodyFrame.charAt(0).toUpperCase() + profile.bodyFrame.slice(1)}<br>
            <strong>DOB:</strong> ${new Date(profile.dateOfBirth).toLocaleDateString()}<br>
            <strong>Starting Weight:</strong> ${profile.startingWeight.value} ${profile.startingWeight.unit}<br>
            <strong>Starting Height:</strong> ${profile.startingHeight.value} ${profile.startingHeight.unit}<br>
            <strong>Start Date:</strong> ${new Date(profile.startingDate).toLocaleDateString()}
          </div>
        </div>
      `).join('');
    }

    function loadEditableProfiles() {
      const container = document.getElementById('edit-profiles-list');
      if (!container) return;
      
      container.innerHTML = Object.entries(profileData).map(([key, profile]) => `
        <div class="profile-card" onclick="editProfile('${key}')">
          <div class="profile-name">${profile.name}</div>
          <div class="profile-details">
            Click to edit this profile
          </div>
        </div>
      `).join('');
    }

    function editProfile(profileKey) {
      editingProfile = profileKey;
      const profile = profileData[profileKey];
      
      // Populate form with profile data
      document.getElementById('edit-profile-name').value = profile.name;
      document.getElementById('edit-date-birth').value = profile.dateOfBirth;
      document.getElementById('edit-start-date').value = profile.startingDate;
      document.getElementById('edit-start-weight').value = profile.startingWeight.value;
      document.getElementById('edit-start-height').value = profile.startingHeight.value;
      
      // Set active pills
      document.querySelectorAll('[data-gender]').forEach(pill => pill.classList.remove('active'));
      document.getElementById(`edit-gender-${profile.gender}`)?.classList.add('active');
      
      document.querySelectorAll('[data-frame]').forEach(pill => pill.classList.remove('active'));
      document.getElementById(`edit-frame-${profile.bodyFrame}`)?.classList.add('active');
      
      document.querySelectorAll('[data-weight-unit]').forEach(pill => pill.classList.remove('active'));
      document.getElementById(`edit-weight-${profile.startingWeight.unit}`)?.classList.add('active');
      
      document.querySelectorAll('[data-height-unit]').forEach(pill => pill.classList.remove('active'));
      document.getElementById(`edit-height-${profile.startingHeight.unit}`)?.classList.add('active');
      
      goToScreen('edit-profile-form');
    }

    function updateProfile() {
      if (!editingProfile) return;
      
      const name = document.getElementById('edit-profile-name')?.value;
      const dateOfBirth = document.getElementById('edit-date-birth')?.value;
      const startDate = document.getElementById('edit-start-date')?.value;
      const startWeight = document.getElementById('edit-start-weight')?.value;
      const startHeight = document.getElementById('edit-start-height')?.value;
      
      // Get selected values from pills
      const gender = document.querySelector('#edit-profile-form [data-gender].active')?.dataset.gender;
      const frame = document.querySelector('#edit-profile-form [data-frame].active')?.dataset.frame;
      const weightUnit = document.querySelector('#edit-profile-form [data-weight-unit].active')?.dataset.weightUnit;
      const heightUnit = document.querySelector('#edit-profile-form [data-height-unit].active')?.dataset.heightUnit;
      
      if (!name || !dateOfBirth || !gender || !frame || !startDate || !startWeight || !startHeight) {
        alert('Please fill in all fields');
        return;
      }
      
      // Update the profile
      const oldProfile = profileData[editingProfile];
      const updatedProfile = {
        ...oldProfile,
        name: name,
        dateOfBirth: dateOfBirth,
        gender: gender,
        bodyFrame: frame,
        startingDate: startDate,
        startingWeight: { value: parseFloat(startWeight), unit: weightUnit },
        startingHeight: { value: parseFloat(startHeight), unit: heightUnit }
      };
      
      // If name changed, update the key
      if (name !== editingProfile) {
        delete profileData[editingProfile];
        profileData[name] = updatedProfile;
      } else {
        profileData[editingProfile] = updatedProfile;
      }
      
      alert('Profile updated successfully!');
      editingProfile = null;
      goToScreen('edit-profiles');
    }

    function saveMeasurements() {
      if (!currentProfile) {
        alert('No profile selected');
        return;
      }
      
      const profile = profileData[currentProfile];
      const measurements = {};
      let hasChanges = false;
      
      ['weight', 'chest', 'waist', 'hips', 'shoulders', 'arms'].forEach(key => {
        const input = document.getElementById(key);
        if (input && input.value) {
          const newValue = parseFloat(input.value);
          if (newValue !== profile.measurements[key]) {
            hasChanges = true;
          }
          profile.measurements[key] = newValue;
        }
      });
      
      if (hasChanges) {
        alert('Measurements saved successfully!');
      } else {
        alert('No changes to save.');
      }
    }

    // Event listeners for pills
    function setupPillEventListeners() {
      // Body type selection
      document.querySelectorAll('[data-type]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          document.querySelectorAll('[data-type]').forEach(p => p.classList.remove('active'));
          e.target.classList.add('active');
          selectedBodyType = e.target.dataset.type;
        });
      });
      
      // Unit selection
      document.querySelectorAll('[data-unit]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          document.querySelectorAll('[data-unit]').forEach(p => p.classList.remove('active'));
          e.target.classList.add('active');
          selectedUnit = e.target.dataset.unit;
        });
      });

      // Gender selection
      document.querySelectorAll('[data-gender]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          const container = e.target.closest('.form-group');
          if (container) {
            container.querySelectorAll('[data-gender]').forEach(p => p.classList.remove('active'));
            e.target.classList.add('active');
          }
        });
      });

      // Frame selection
      document.querySelectorAll('[data-frame]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          const container = e.target.closest('.form-group');
          if (container) {
            container.querySelectorAll('[data-frame]').forEach(p => p.classList.remove('active'));
            e.target.classList.add('active');
          }
        });
      });

      // Weight unit selection
      document.querySelectorAll('[data-weight-unit]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          const container = e.target.closest('.form-group');
          if (container) {
            container.querySelectorAll('[data-weight-unit]').forEach(p => p.classList.remove('active'));
            e.target.classList.add('active');
          }
        });
      });

      // Height unit selection
      document.querySelectorAll('[data-height-unit]').forEach(pill => {
        pill.addEventListener('click', (e) => {
          const container = e.target.closest('.form-group');
          if (container) {
            container.querySelectorAll('[data-height-unit]').forEach(p => p.classList.remove('active'));
            e.target.classList.add('active');
          }
        });
      });
    }

    // Initialize app
    function initApp() {
      setupPillEventListeners();
      updateNavigation();
      
      // Set default profile if none exists
      if (Object.keys(profileData).length > 0) {
        currentProfile = Object.keys(profileData)[0];
      }
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
