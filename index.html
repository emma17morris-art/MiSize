<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize - Size Finder & Body Tracker!</title>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer {
      flex: 1;
    }
    
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header {
      margin-bottom: 40px;
    }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-tile:active {
      transform: translateY(-2px);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover {
      color: var(--brand);
    }
    
    .nav-item.active {
      color: var(--brand);
    }

    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: block;
    }

    .system-status {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 2px solid var(--border);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-online { background: var(--green); }
    .status-loading { background: var(--orange); }
    .status-offline { background: var(--muted); }

    .btn {
      padding: 12px 24px;
      background: var(--brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 8px;
      font-weight: bold;
    }

    .btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize</div>
      
      <div class="pill-group">
        <button class="pill active" data-type="standard">Std</button>
        <button class="pill" data-type="petite">Petite</button>
        <button class="pill" data-type="tall">Tall</button>
        <button class="pill" data-type="plus">Plus</button>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize</h1>
        <p class="subtitle">Your personal size finder and body tracker with AI-powered sizing!</p>
      </div>
      
      <div class="system-status">
        <div class="status-indicator">
          <div class="status-dot status-loading" id="system-status-dot"></div>
          <span id="system-status-text">Initializing AI system...</span>
        </div>
      </div>
      
      <div class="region-grid">
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">🇬🇧</span>
          <h3 class="region-name">UK</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">🇪🇺</span>
          <h3 class="region-name">EU</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">🇺🇸</span>
          <h3 class="region-name">US</h3>
        </div>
        
        <div class="region-tile" onclick="alert('Coming soon!')">
          <span class="region-flag">🇨🇦</span>
          <h3 class="region-name">CA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Test Screen -->
  <div id="test-screen" class="screen">
    <div class="main-container">
      <h1 class="title">AI Engine Test</h1>
      <p class="subtitle" id="data-status">Testing AI system...</p>
      
      <div id="profile-info" style="margin-top: 20px; text-align: left; max-width: 600px;"></div>
      
      <div style="margin-top: 20px;">
        <button class="btn" onclick="testAISystem()">Test AI Size Finder</button>
        <button class="btn" onclick="testGetAllSizes()">Test Get All Sizes</button>
      </div>
      
      <div id="ai-results" style="margin-top: 20px; text-align: left; max-width: 800px;"></div>
      
      <button onclick="goHome()" class="btn" style="margin-top: 20px;">Go Home</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="goHome()">Home</button>
    <button class="nav-item" onclick="goToScreen('test-screen')">Test AI</button>
    <button class="nav-item" onclick="alert('MiStats coming soon!')">MiStats</button>
    <button class="nav-item" onclick="alert('Settings coming soon!')">Settings</button>
    <button class="nav-item" onclick="alert('Help coming soon!')">Help</button>
  </div>

<script>
// Global variables
let currentScreen = 'home';
let navigationHistory = [];
let selectedBodyType = 'standard';
let selectedUnit = 'cm';
let currentProfile = 'Emma Morris';
let miSizeSystem = null;

// Profile Data (same as before)
let profileData = {
  'Emma Morris': {
    name: 'Emma Morris',
    dateOfBirth: '1983-10-12',
    gender: 'female',
    bodyFrame: 'medium',
    startingDate: '2022-03-19',
    startingWeight: { value: 150, unit: 'kg' },
    startingHeight: { value: 183, unit: 'cm' },
    targetWeight: { value: 80, unit: 'kg' },
    targetDate: '2023-06-30',
    measurements: { weight: 80, chest: 36, waist: 34, hips: 38, shoulders: 38, arms: 28 },
    history: [
      { date: '2022-03-19', type: 'weight', value: 150, unit: 'kg' },
      { date: '2023-08-19', type: 'weight', value: 80, unit: 'kg' },
      { date: '2024-12-19', type: 'waist', value: 34, unit: 'inch' },
      { date: '2024-12-19', type: 'hips', value: 38, unit: 'inch' },
      { date: '2024-12-19', type: 'chest', value: 36, unit: 'inch' }
    ]
  }
};

// Brand Database (expanded)
const BRAND_SIZE_DATABASE = {
  'ASOS': {
    name: 'ASOS',
    lastUpdated: new Date().toISOString(),
    categories: {
      "Women's Tops": {
        '8': { bust: 32, waist: 26, hips: 34 },
        '10': { bust: 34, waist: 28, hips: 36 },
        '12': { bust: 36, waist: 30, hips: 38 },
        '14': { bust: 38, waist: 32, hips: 40 },
        '16': { bust: 40, waist: 34, hips: 42 },
        '18': { bust: 42, waist: 36, hips: 44 },
        '20': { bust: 44, waist: 38, hips: 46 }
      }
    },
    notes: {
      sizing: 'UK sizes, runs slightly large',
      bodyTypes: 'Standard, Petite, Tall, Plus',
      categories: 'Full range - jeans, dresses, tops, shoes, activewear',
      fitNotes: 'Size down for oversized items, true to size for fitted',
      special: 'Excellent size inclusivity, detailed size guides, online exclusive'
    }
  },
  'Zara': {
    name: 'Zara',
    lastUpdated: new Date().toISOString(),
    categories: {
      "Women's Tops": {
        'S': { bust: 34, waist: 28, hips: 36 },
        'M': { bust: 36, waist: 30, hips: 38 },
        'L': { bust: 38, waist: 32, hips: 40 },
        'XL': { bust: 40, waist: 34, hips: 42 },
        'XXL': { bust: 42, waist: 36, hips: 44 }
      }
    },
    notes: {
      sizing: 'European sizes, runs small',
      bodyTypes: 'Standard, Limited plus sizes',
      categories: 'Trend fashion - dresses, tops, jeans, shoes',
      fitNotes: 'Size up 1-2 sizes, fitted cuts',
      special: 'Fast fashion, trend-focused, size up recommended'
    }
  }
};

console.log('🚀 MiSize App Starting with AI Engine...');

// AI SIZE MATCHING ENGINE (from Section 4)
class SizeMatchingEngine {
  constructor() {
    this.brandDatabase = BRAND_SIZE_DATABASE;
    this.userMeasurements = {};
    this.fitPreferences = { 'snug': -1, 'standard': 0, 'relaxed': 1 };
    console.log('🤖 SizeMatchingEngine created');
  }

  setUserMeasurements(measurements) {
    this.userMeasurements = {
      bust: parseFloat(measurements.bust) || 0,
      waist: parseFloat(measurements.waist) || 0,
      hips: parseFloat(measurements.hips) || 0,
      unit: measurements.unit || 'inch'
    };
    console.log('📏 AI measurements updated:', this.userMeasurements);
  }

  findBestSizeForBrand(brandName, category, fitPreference = 'standard') {
    const brandData = this.brandDatabase[brandName];
    if (!brandData || !brandData.categories) {
      console.warn(`No brand data found for: ${brandName}`);
      return null;
    }

    const categoryData = brandData.categories[category];
    if (!categoryData) {
      console.warn(`No category data found for: ${brandName} - ${category}`);
      return null;
    }

    const fitAdjustment = this.fitPreferences[fitPreference.toLowerCase()] || 0;
    const sizeAnalysis = this.analyzeSizes(categoryData, fitAdjustment);

    return {
      brand: brandName,
      recommendedSize: sizeAnalysis.bestSize,
      confidence: sizeAnalysis.confidence,
      fitAnalysis: sizeAnalysis.fitDetails,
      alternatives: sizeAnalysis.alternatives,
      category: category,
      fitPreference: fitPreference
    };
  }

  analyzeSizes(categoryData, fitAdjustment) {
    const userMeasurements = this.userMeasurements;
    const sizeScores = new Map();
    const sizeDetails = new Map();

    Object.entries(categoryData).forEach(([size, measurements]) => {
      const score = this.calculateFitScore(userMeasurements, measurements, fitAdjustment);
      const details = this.generateFitDetails(userMeasurements, measurements, size);
      
      sizeScores.set(size, score);
      sizeDetails.set(size, details);
    });

    const sortedSizes = Array.from(sizeScores.entries()).sort((a, b) => b[1] - a[1]);
    const bestSize = sortedSizes[0];
    const alternatives = sortedSizes.slice(1, 2);

    return {
      bestSize: bestSize[0],
      confidence: this.calculateConfidence(bestSize[1]),
      fitDetails: sizeDetails.get(bestSize[0]),
      alternatives: alternatives.map(([size, score]) => ({
        size: size,
        confidence: this.calculateConfidence(score)
      }))
    };
  }

  calculateFitScore(userMeasurements, sizeMeasurements, fitAdjustment) {
    let totalScore = 0;
    let measurementCount = 0;
    const measurements = ['bust', 'waist', 'hips'];

    measurements.forEach(measurement => {
      if (userMeasurements[measurement] && sizeMeasurements[measurement]) {
        const userValue = userMeasurements[measurement];
        const sizeValue = sizeMeasurements[measurement] + fitAdjustment;
        const difference = Math.abs(userValue - sizeValue);
        const score = Math.max(0, 100 - (difference * 15));
        
        totalScore += score;
        measurementCount++;
      }
    });

    return measurementCount > 0 ? totalScore / measurementCount : 0;
  }

  generateFitDetails(userMeasurements, sizeMeasurements, size) {
    const details = { size: size, measurements: sizeMeasurements, fit: {} };
    const measurements = ['bust', 'waist', 'hips'];

    measurements.forEach(measurement => {
      if (userMeasurements[measurement] && sizeMeasurements[measurement]) {
        const userValue = userMeasurements[measurement];
        const sizeValue = sizeMeasurements[measurement];
        const difference = userValue - sizeValue;

        let fitDescription;
        if (Math.abs(difference) <= 1) {
          fitDescription = 'Perfect fit';
        } else if (difference > 1) {
          fitDescription = `${Math.abs(difference).toFixed(1)}" too small`;
        } else {
          fitDescription = `${Math.abs(difference).toFixed(1)}" too large`;
        }

        details.fit[measurement] = {
          userMeasurement: userValue,
          sizeMeasurement: sizeValue,
          difference: difference,
          description: fitDescription
        };
      }
    });

    return details;
  }

  calculateConfidence(score) {
    return Math.max(0, Math.min(100, Math.round(score)));
  }

  getAllBrandSizes(category, fitPreference = 'standard') {
    const results = [];
    
    Object.keys(this.brandDatabase).forEach(brandName => {
      const result = this.findBestSizeForBrand(brandName, category, fitPreference);
      if (result && result.confidence >= 70) {
        results.push(result);
      }
    });

    return results.sort((a, b) => b.confidence - a.confidence);
  }
}

// MISIZE AI SYSTEM (from Section 4)
class MiSizeAISystem {
  constructor() {
    this.sizeEngine = new SizeMatchingEngine();
    this.isInitialized = false;
    this.confidenceThreshold = 70;
    console.log('🧠 MiSizeAISystem created');
  }

  async initialize() {
    try {
      this.updateSystemStatus('loading', 'Initializing AI sizing system...');
      console.log('🔄 Initializing AI system...');
      
      await this.sleep(1000); // Simulate initialization
      
      this.updateUserMeasurements();
      this.isInitialized = true;
      this.updateSystemStatus('online', 'AI sizing system active');
      
      console.log('✅ MiSize AI System initialized successfully');
      return true;
    } catch (error) {
      console.error('Failed to initialize AI system:', error);
      this.updateSystemStatus('offline', 'System offline - using fallback data');
      return false;
    }
  }

  updateUserMeasurements() {
    const profile = profileData[currentProfile];
    if (profile && profile.measurements) {
      console.log('📊 Loading measurements for:', currentProfile, profile.measurements);
      this.sizeEngine.setUserMeasurements({
        bust: profile.measurements.chest || 36,
        waist: profile.measurements.waist || 34,
        hips: profile.measurements.hips || 38,
        unit: 'inch'
      });
    } else {
      console.warn('No profile measurements found, using defaults');
      this.sizeEngine.setUserMeasurements({ 
        bust: 36, 
        waist: 34, 
        hips: 38, 
        unit: 'inch' 
      });
    }
  }

  async getAccurateSize(brand, category, fitPreference = 'standard') {
    if (!this.isInitialized) {
      throw new Error('AI system not initialized');
    }

    this.updateUserMeasurements();
    const result = this.sizeEngine.findBestSizeForBrand(brand, category, fitPreference);

    if (!result) {
      return {
        success: false,
        message: `No size data available for ${brand} in ${category}`
      };
    }

    return {
      success: true,
      brand: brand,
      category: category,
      recommendedSize: result.recommendedSize,
      confidence: result.confidence,
      fitAnalysis: result.fitAnalysis,
      alternatives: result.alternatives,
      fitPreference: fitPreference
    };
  }

  async getAllMySizes() {
    if (!this.isInitialized) {
      console.warn('AI system not initialized');
      return {};
    }

    this.updateUserMeasurements();
    const categories = ["Women's Tops"];
    const results = {};

    for (const category of categories) {
      results[category] = this.sizeEngine.getAllBrandSizes(category, 'standard')
        .filter(result => result.confidence >= this.confidenceThreshold);
    }

    console.log('Generated all sizes:', results);
    return results;
  }

  updateSystemStatus(status, message) {
    const statusDot = document.getElementById('system-status-dot');
    const statusText = document.getElementById('system-status-text');
    
    if (statusDot) statusDot.className = `status-dot status-${status}`;
    if (statusText) statusText.textContent = message;
  }

  sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

// UTILITY FUNCTIONS (from Section 4)
function kgFrom(value, unit) {
  if (unit === 'kg') return value;
  if (unit === 'lbs') return value * 0.45359237;
  if (unit === 'stone') return value * 6.35029318;
  return value;
}

function computeBMIKgCm(weightKg, heightCm) {
  const h = heightCm / 100;
  if (!h) return null;
  return weightKg / (h * h);
}

function bmiCategory(bmi) {
  if (bmi == null) return '';
  if (bmi < 18.5) return 'Underweight';
  if (bmi < 25) return 'Normal Weight';
  if (bmi < 30) return 'Overweight';
  return 'Obese';
}

// Navigation functions
function goToScreen(screenId) {
  console.log('Navigating to:', screenId);
  
  document.querySelectorAll('.screen').forEach(screen => {
    screen.classList.remove('active');
  });
  
  const targetScreen = document.getElementById(screenId);
  if (targetScreen) {
    targetScreen.classList.add('active');
    currentScreen = screenId;
    
    if (screenId === 'test-screen') {
      displayAITest();
    }
    
    updateNavigation();
    console.log('✅ Navigation successful');
  } else {
    console.error('❌ Screen not found:', screenId);
  }
}

function goHome() {
  goToScreen('home');
}

function enterHub(region) {
  console.log('Entering hub:', region);
  if (region === 'UK') {
    goToScreen('test-screen');
  } else {
    alert(region + ' hub coming soon!');
  }
}

// AI Testing Functions
async function testAISystem() {
  console.log('🧪 Testing AI system...');
  const resultsDiv = document.getElementById('ai-results');
  
  try {
    if (!miSizeSystem || !miSizeSystem.isInitialized) {
      console.log('Initializing AI system for test...');
      if (!miSizeSystem) {
        miSizeSystem = new MiSizeAISystem();
      }
      await miSizeSystem.initialize();
    }
    
    const result = await miSizeSystem.getAccurateSize('ASOS', "Women's Tops", 'standard');
    
    if (result.success) {
      resultsDiv.innerHTML = `
        <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--green);">
          <h3 style="color: var(--green); margin-top: 0;">✅ AI Test Successful!</h3>
          <p><strong>Brand:</strong> ${result.brand}</p>
          <p><strong>Recommended Size:</strong> ${result.recommendedSize}</p>
          <p><strong>Confidence:</strong> ${result.confidence}%</p>
          <p><strong>Fit Analysis:</strong></p>
          <ul>
            ${Object.entries(result.fitAnalysis.fit).map(([measurement, details]) => 
              `<li>${measurement.toUpperCase()}: ${details.description}</li>`
            ).join('')}
          </ul>
          ${result.alternatives.length > 0 ? `
            <p><strong>Alternatives:</strong> ${result.alternatives.map(alt => `${alt.size} (${alt.confidence}%)`).join(', ')}</p>
          ` : ''}
        </div>
      `;
    } else {
      resultsDiv.innerHTML = `
        <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
          <h3 style="color: var(--orange); margin-top: 0;">⚠️ AI Test Issue</h3>
          <p>${result.message}</p>
        </div>
      `;
    }
    
  } catch (error) {
    console.error('AI test failed:', error);
    resultsDiv.innerHTML = `
      <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
        <h3 style="color: var(--orange); margin-top: 0;">❌ AI Test Failed</h3>
        <p>Error: ${error.message}</p>
      </div>
    `;
  }
}

async function testGetAllSizes() {
  console.log('🧪 Testing Get All Sizes...');
  const resultsDiv = document.getElementById('ai-results');
  
  try {
    if (!miSizeSystem || !miSizeSystem.isInitialized) {
      if (!miSizeSystem) {
        miSizeSystem = new MiSizeAISystem();
      }
      await miSizeSystem.initialize();
    }
    
    const allSizes = await miSizeSystem.getAllMySizes();
    
    let html = `<div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--green);">
      <h3 style="color: var(--green); margin-top: 0;">✅ All Sizes Test Successful!</h3>`;
    
    Object.entries(allSizes).forEach(([category, recommendations]) => {
      html += `<h4>${category}:</h4><ul>`;
      recommendations.forEach(rec => {
        html += `<li>${rec.brand}: Size ${rec.recommendedSize} (${rec.confidence}% confidence)</li>`;
      });
      html += `</ul>`;
    });
    
    html += `</div>`;
    resultsDiv.innerHTML = html;
    
  } catch (error) {
    console.error('Get All Sizes test failed:', error);
    resultsDiv.innerHTML = `
      <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--orange);">
        <h3 style="color: var(--orange); margin-top: 0;">❌ Get All Sizes Test Failed</h3>
        <p>Error: ${error.message}</p>
      </div>
    `;
  }
}

function displayAITest() {
  const statusElement = document.getElementById('data-status');
  const infoElement = document.getElementById('profile-info');
  
  if (!statusElement || !infoElement) return;
  
  try {
    const profile = profileData[currentProfile];
    
    statusElement.textContent = `🤖 AI Engine loaded - Ready to test size calculations`;
    
    infoElement.innerHTML = `
      <div style="background: var(--card); padding: 20px; border-radius: 12px; border: 2px solid var(--border);">
        <h3 style="color: var(--brand); margin-top: 0;">AI System Status</h3>
        <p><strong>Status:</strong> ${miSizeSystem ? (miSizeSystem.isInitialized ? '✅ Ready' : '⏳ Not initialized') : '❌ Not created'}</p>
        <p><strong>Profile:</strong> ${profile.name}</p>
        <p><strong>Measurements:</strong> ${profile.measurements.chest}" bust, ${profile.measurements.waist}" waist, ${profile.measurements.hips}" hips</p>
        <p><strong>Available Brands:</strong> ${Object.keys(BRAND_SIZE_DATABASE).length} brands loaded</p>
        
        <div style="margin-top: 16px;">
          <p><strong>Click the buttons above to test the AI engine:</strong></p>
          <ul style="text-align: left;">
            <li><strong>Test AI Size Finder:</strong> Tests finding your size for ASOS Women's Tops</li>
            <li><strong>Test Get All Sizes:</strong> Tests getting all recommended sizes across brands</li>
          </ul>
        </div>
      </div>
    `;
    
  } catch (error) {
    console.error('Error displaying AI test:', error);
    statusElement.textContent = '❌ Error setting up AI test';
  }
}

function updateNavigation() {
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  
  if (currentScreen === 'home') {
    document.querySelector('.nav-item[onclick="goHome()"]')?.classList.add('active');
  } else if (currentScreen === 'test-screen') {
    document.querySelector('.nav-item[onclick="goToScreen(\'test-screen\')"]')?.classList.add('active');
  }
}

// Pill controls
function setupPillControls() {
  console.log('Setting up pill controls...');
  
  document.querySelectorAll('.pill[data-type]').forEach(pill => {
    pill.addEventListener('click', function() {
      document.querySelectorAll('.pill[data-type]').forEach(p => p.classList.remove('active'));
      this.classList.add('active');
      selectedBodyType = this.dataset.type;
      console.log('Body type selected:', selectedBodyType);
    });
  });

  document.querySelectorAll('.pill[data-unit]').forEach(pill => {
    pill.addEventListener('click', function() {
      document.querySelectorAll('.pill[data-unit]').forEach(p => p.classList.remove('active'));
      this.classList.add('active');
      selectedUnit = this.dataset.unit;
      console.log('Unit selected:', selectedUnit);
    });
  });
  
  console.log('✅ Pill controls set up');
}

// Initialize app
async function initApp() {
  console.log('🔄 Initializing app with AI engine...');
  
  try {
    setupPillControls();
    updateNavigation();
    
    // Initialize AI system
    miSizeSystem = new MiSizeAISystem();
    await miSizeSystem.initialize();
    
    console.log('📊 System check:');
    console.log('- Profiles loaded:', Object.keys(profileData).length);
    console.log('- Brands loaded:', Object.keys(BRAND_SIZE_DATABASE).length);
    console.log('- AI system ready:', miSizeSystem.isInitialized);
    
    console.log('✅ App initialized successfully with AI');
    
  } catch (error) {
    console.error('❌ App initialization failed:', error);
    alert('App failed to initialize: ' + error.message);
  }
}

// Start the app
document.addEventListener('DOMContentLoaded', function() {
  console.log('📄 DOM loaded, starting app with AI...');
  initApp();
});

console.log('📜 Script loaded with AI Engine');
</script>
</body>
</html>
