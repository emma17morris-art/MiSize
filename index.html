<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MiSize</title>

<style>
:root{
  --bg:#0f131a; --card:#151a22; --border:#243048; --muted:#aab3c5;
  --tile:#1d2430; --tile2:#202a3b; --accent:#5da8ff; --accent2:#9f7bff; --accent3:#59d3a0; --accent4:#ff9a9a;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#eef1f5;}
h1,h2,h3{margin:0;font-weight:800;}
.big{font-size:20px;}
.note{font-size:13px;color:var(--muted);}
.screen{display:none;padding:18px;max-width:900px;margin:0 auto;}
.screen.active{display:block;}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:18px;}
.row{display:grid;grid-gap:12px;}
.row.two{grid-template-columns:repeat(2,1fr);}
.row.three{grid-template-columns:repeat(3,1fr);}
label{font-size:13px;color:var(--muted);}
select,input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f131a;color:#eef1f5;}
button{cursor:pointer}
button.pill{padding:6px 12px;border-radius:16px;border:1px solid var(--border);background:#1d2430;color:#eef1f5;}
.pill-row{display:flex;flex-wrap:wrap;gap:8px;}
.profile-pill{padding:4px 10px;border-radius:14px;border:1px solid var(--border);background:#1d2430;color:#eef1f5;}
.profile-pill.active{background:var(--accent);color:#fff;}
.profile-pill.add{border-style:dashed;}

/* Topbar (with logo + pills) */
.topbar{position:sticky;top:0;z-index:100;backdrop-filter:saturate(120%) blur(8px);background:rgba(15,19,26,.75);border-bottom:1px solid var(--border);padding:6px 10px;}
.topbar-inner{display:flex;gap:10px;align-items:center;flex-wrap:wrap;max-width:1200px;margin:0 auto;}
.brand{display:flex;align-items:center;gap:8px}
.brand img{height:18px;display:block}
.topbar h1{font-size:14px;margin:0;font-weight:900;letter-spacing:.2px;color:#cfe0ff;}

/* Home tiles */
.tile-grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:12px}
.tile{display:flex;align-items:center;justify-content:center;height:64px;border-radius:18px;border:1px solid var(--border);background:var(--tile);font-weight:700;letter-spacing:.4px}
.tile.uk{background:linear-gradient(180deg,rgba(93,168,255,.18),rgba(93,168,255,.05));}
.tile.eu{background:linear-gradient(180deg,rgba(159,123,255,.18),rgba(159,123,255,.05));}
.tile.us{background:linear-gradient(180deg,rgba(89,211,160,.18),rgba(89,211,160,.05));}
.tile.ca{background:linear-gradient(180deg,rgba(255,154,154,.18),rgba(255,154,154,.05));}
@media (min-width:560px){ .tile-grid{grid-template-columns:1fr 1fr} }
@media (min-width:900px){ .tile-grid{grid-template-columns:1fr 1fr} .tile{height:84px} }

/* Hub list inside regions */
.hub-list{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
.hub-pill{padding:14px 16px;border-radius:14px;border:1px solid var(--border);background:#1d2430;text-align:center;font-weight:700}
.hub-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.hub-back{border:1px solid var(--border);background:#1a2230;border-radius:12px;padding:6px 10px}

/* Bottom tabs */
.bottom-tabs{position:sticky;bottom:0;display:flex;justify-content:space-around;background:#151a22;border-top:1px solid var(--border);}
.bottom-tabs .tab{flex:1;padding:12px;border:none;background:none;color:#eef1f5;font-weight:600}
.bottom-tabs .tab.active{background:#243048;}

/* Profile layout (3 in a row on wide) */
#profile select,#profile input{padding:10px;font-size:14px;border-radius:10px;}
@media (min-width:760px){
  #profile .row.two{grid-template-columns:repeat(3,1fr);}
}

/* MiStats graph */
#mi_canvas{width:100%;height:220px;background:#0f131a;border:1px solid var(--border);border-radius:8px;}
.mi-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border);}
.mi-row:last-child{border-bottom:none;}
.delta.down{color:#5da8ff;}
.delta.up{color:#ff9a9a;}
</style>

<body>

<!-- Topbar -->
<div class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <!-- swap LOGO_SRC for your image path -->
      <img src="LOGO_SRC" alt="" onerror="this.remove()">
      <h1>MiSize</h1>
    </div>
    <div class="pill-row" id="bodyTypePills"></div>
    <div class="pill-row" id="unitPills"></div>
  </div>
</div>

<!-- Splash -->
<section id="splash" class="screen active" aria-label="Splash">
  <div class="card" style="text-align:center">
    <h2 class="big">Loading MiSize…</h2>
    <p class="note">Your styles & profile will appear in a sec.</p>
  </div>
</section>

<!-- Home Hub -->
<section id="home" class="screen" aria-label="Home">
  <h2 class="big">Home</h2>
  <p class="note">Pick a region to open its hub.</p>
  <div class="tile-grid">
    <button class="tile uk" onclick="openRegion('uk')">UK</button>
    <button class="tile eu" onclick="openRegion('eu')">EU</button>
    <button class="tile us" onclick="openRegion('us')">US</button>
    <button class="tile ca" onclick="openRegion('ca')">CA</button>
  </div>
</section>

<!-- Region Hubs -->
<section id="uk" class="screen" aria-label="UK Hub">
  <div class="hub-head">
    <h2 class="big">UK Hub</h2>
    <button class="hub-back" onclick="hubBack()">Back</button>
  </div>
  <div class="hub-list">
    <button class="hub-pill" onclick="openScreen('uk_size')">Size Finder</button>
    <button class="hub-pill" onclick="openScreen('uk_conv')">Converters</button>
    <button class="hub-pill" onclick="openScreen('uk_store')">Store Finder</button>
  </div>
</section>

<section id="eu" class="screen"><div class="hub-head"><h2 class="big">EU Hub</h2><button class="hub-back" onclick="hubBack()">Back</button></div>
  <div class="hub-list"><button class="hub-pill" onclick="openScreen('eu_size')">Size Finder</button><button class="hub-pill" onclick="openScreen('eu_conv')">Converters</button></div>
</section>
<section id="us" class="screen"><div class="hub-head"><h2 class="big">US Hub</h2><button class="hub-back" onclick="hubBack()">Back</button></div>
  <div class="hub-list"><button class="hub-pill" onclick="openScreen('us_size')">Size Finder</button><button class="hub-pill" onclick="openScreen('us_conv')">Converters</button></div>
</section>
<section id="ca" class="screen"><div class="hub-head"><h2 class="big">CA Hub</h2><button class="hub-back" onclick="hubBack()">Back</button></div>
  <div class="hub-list"><button class="hub-pill" onclick="openScreen('ca_size')">Size Finder</button><button class="hub-pill" onclick="openScreen('ca_conv')">Converters</button></div>
</section>

<!-- UK sub-screens -->
<section id="uk_size" class="screen"><h2 class="big">UK • Size Finder</h2>
  <div class="card"><p class="note">Use your saved measurements. Hub button = Back.</p></div>
</section>
<section id="uk_conv" class="screen"><h2 class="big">UK • Converters</h2>
  <div class="card"><p class="note">Length, shoes, jeans etc (plug your components here).</p></div>
</section>
<section id="uk_store" class="screen"><h2 class="big">UK • Store Finder</h2>
  <div class="card"><p class="note">Your store list / map goes here.</p></div>
</section>

<!-- Profile -->
<section id="profile" class="screen">
  <h2 class="big">Profile</h2>
  <p class="note">Measurements save to local storage (stored internally in cm).</p>
  <div class="card">
    <div class="row two">
      <div><label>Profile name</label><input id="m_name" placeholder="e.g., Emma"></div>
      <div><label>Sex</label>
        <select id="m_sex">
          <option value="female">Female</option>
          <option value="male">Male</option>
        </select>
      </div>

      <div><label id="lab_height">Height (cm)</label><input id="m_height" inputmode="decimal" placeholder="e.g., 168"></div>
      <div><label id="lab_bust">Bust (cm)</label><input id="m_bust" inputmode="decimal"></div>
      <div><label id="lab_waist">Waist (cm)</label><input id="m_waist" inputmode="decimal"></div>
      <div><label id="lab_hip">Hip (cm)</label><input id="m_hip" inputmode="decimal"></div>
      <div><label id="lab_thigh">Thigh (cm)</label><input id="m_thigh" inputmode="decimal"></div>
      <div><label id="lab_calf">Calf (cm)</label><input id="m_calf" inputmode="decimal"></div>
      <div><label id="lab_neck">Neck (cm)</label><input id="m_neck" inputmode="decimal"></div>
      <!-- extra common asks -->
      <div><label id="lab_underbust">Underbust (cm)</label><input id="m_underbust" inputmode="decimal"></div>
      <div><label id="lab_inseam">Inseam (cm)</label><input id="m_inseam" inputmode="decimal"></div>
      <div><label id="lab_arm">Arm length (cm)</label><input id="m_arm" inputmode="decimal"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="pill" onclick="saveProfile()">Save profile</button>
      <button class="pill" onclick="resetProfile()">Reset fields</button>
      <button class="pill" onclick="deleteProfile()">Delete profile</button>
    </div>
  </div>
</section>

<!-- MiStats -->
<section id="mistats" class="screen">
  <h2 class="big">MiStats</h2>
  <div class="card" id="mi_view_current"></div>
  <div class="card"><canvas id="mi_canvas" width="640" height="220"></canvas><p id="mi_graph_note" class="note"></p></div>
  <div class="card" id="mi_view_history"></div>
</section>

<!-- Settings (merged) -->
<section id="settings" class="screen">
  <h2 class="big">Settings</h2>

  <div class="card">
    <div class="row two">
      <div>
        <div class="big">Profiles</div>
        <p class="note">Switch or add profiles here. These drive MiStats.</p>
      </div>
      <div style="display:flex;align-items:center;justify-content:flex-end;">
        <button class="pill" onclick="switchTab('profile')">Open Profile editor</button>
      </div>
    </div>
    <div id="profilePillsSettings" class="pill-row" style="margin-top:10px;"></div>
  </div>

  <div class="card">
    <div class="row two">
      <div>
        <div class="big">Display units</div>
        <p class="note">Affects labels & inputs. Internally stored as cm / kg.</p>
      </div>
      <div>
        <div class="pill-row">
          <button class="pill" data-unit="cm">Centimeters</button>
          <button class="pill" data-unit="in">Inches</button>
        </div>
        <div class="pill-row" style="margin-top:8px">
          <button class="pill" data-wu="kg">Kilograms</button>
          <button class="pill" data-wu="lb">Pounds</button>
          <button class="pill" data-wu="st">Stones</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Bottom Tabs -->
<div class="bottom-tabs" role="tablist">
  <button id="tab_home" class="tab active" onclick="switchTab('home')">Home</button>
  <button id="tab_profile" class="tab" onclick="switchTab('profile')">Profile</button>
  <button id="tab_mistats" class="tab" onclick="switchTab('mistats')">MiStats</button>
  <button id="tab_settings" class="tab" onclick="switchTab('settings')">Settings</button>
  <button id="tab_hub" class="tab" onclick="hubBack()">Hub</button>
</div>

<script>
/* --------------- tiny helpers --------------- */
const $=id=>document.getElementById(id);

/* --------------- navigation --------------- */
let CURRENT_SCREEN='splash';
const ROOT_SCREENS=['home','uk','eu','us','ca','profile','mistats','settings','splash'];

function switchTab(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  const t = $('tab_'+id); if(t) t.classList.add('active');
  CURRENT_SCREEN=id;
}
function openRegion(id){ switchTab(id); }
function openScreen(id){ switchTab(id); }
function hubBack(){
  // behave like a back-to-region/home helper
  if (CURRENT_SCREEN && CURRENT_SCREEN.includes('_')) {
    const region = CURRENT_SCREEN.split('_')[0]; switchTab(region); return;
  }
  if (!ROOT_SCREENS.includes(CURRENT_SCREEN)) { switchTab('home'); return; }
  switchTab('home');
}

/* --------------- profiles --------------- */
function getProfiles(){ return JSON.parse(localStorage.getItem('profiles')||'[]'); }
function setProfiles(p){ localStorage.setItem('profiles',JSON.stringify(p)); }
function getActiveId(){
  let id=localStorage.getItem('activeProfileId');
  const p=getProfiles();
  if(!p.length){ const seed=[{id:'p1',name:'Emma',sex:'female'}]; setProfiles(seed); id='p1'; localStorage.setItem('activeProfileId',id); }
  return id||'p1';
}
function activeProfile(){
  const id=getActiveId(); const arr=getProfiles();
  return arr.find(x=>x.id===id) || {id,name:'Profile'};
}
function saveProfile(){
  const arr=getProfiles(); const id=getActiveId();
  const i=arr.findIndex(x=>x.id===id);
  const u=toCmIfNeeded({
    name:$('m_name').value,sex:$('m_sex').value,
    height:valNum('m_height'),bust:valNum('m_bust'),waist:valNum('m_waist'),
    hip:valNum('m_hip'),thigh:valNum('m_thigh'),calf:valNum('m_calf'),
    neck:valNum('m_neck'),underbust:valNum('m_underbust'),inseam:valNum('m_inseam'),arm:valNum('m_arm')
  });
  arr[i]={...arr[i],...u};
  setProfiles(arr);
  renderProfilePills();
  alert('Profile saved');
}
function deleteProfile(){
  let arr=getProfiles(); if(arr.length<=1){ alert('Keep at least one profile'); return; }
  const id=getActiveId(); arr=arr.filter(p=>p.id!==id); setProfiles(arr); localStorage.setItem('activeProfileId',arr[0].id);
  renderProfilePills(); loadProfileForm();
}
function resetProfile(){ document.querySelectorAll('#profile input').forEach(i=>i.value=''); }

function valNum(id){ const v=parseFloat($(id).value); return Number.isFinite(v)?v:null; }

/* --------------- top-bar pills --------------- */
function setupPills(){
  // body type (placeholder for you to extend)
  const bt = document.getElementById('bodyTypePills');
  bt.innerHTML = '';
  ['Female','Male'].forEach(k=>{
    const b=document.createElement('button'); b.className='pill'; b.textContent=k;
    b.dataset.bt=k.toLowerCase();
    if(localStorage.getItem('bodyType')===b.dataset.bt) b.classList.add('active');
    b.onclick=()=>{ localStorage.setItem('bodyType',b.dataset.bt); bt.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
    bt.appendChild(b);
  });

  // length unit
  const up = document.getElementById('unitPills');
  up.innerHTML = '<span class="note" style="align-self:center;margin-right:4px">Length:</span>';
  ['cm','in'].forEach(u=>{
    const b=document.createElement('button'); b.className='pill'; b.textContent=(u==='cm'?'Centimeters':'Inches');
    b.dataset.unit=u; if(getLenUnit()===u) b.classList.add('active');
    b.onclick=()=>{ setLenUnit(u); up.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); b.classList.add('active'); updateUnitLabels(); };
    up.appendChild(b);
  });
}

/* --------------- units --------------- */
function getLenUnit(){ return localStorage.getItem('lenUnit')||'cm'; }
function setLenUnit(u){ localStorage.setItem('lenUnit',u); }
function cmToIn(cm){ return cm==null?null:(cm/2.54); }
function inToCm(i){ return i==null?null:(i*2.54); }
function toCmIfNeeded(obj){
  if(getLenUnit()==='cm') return obj;
  const out={...obj};
  ['height','bust','waist','hip','thigh','calf','neck','underbust','inseam','arm'].forEach(k=>{
    if(out[k]!=null) out[k]=+inToCm(out[k]).toFixed(2);
  });
  return out;
}
function fromCmIfNeeded(obj){
  if(getLenUnit()==='cm') return obj;
  const out={...obj};
  ['height','bust','waist','hip','thigh','calf','neck','underbust','inseam','arm'].forEach(k=>{
    if(out[k]!=null) out[k]=+cmToIn(out[k]).toFixed(2);
  });
  return out;
}
function updateUnitLabels(){
  const u=getLenUnit()==='cm'?'cm':'in';
  ['height','bust','waist','hip','thigh','calf','neck','underbust','inseam','arm'].forEach(k=>{
    const lab=$('lab_'+k); if(lab) lab.textContent = lab.textContent.replace(/\(.*\)/,'(' + u + ')');
  });
}

/* --------------- profile pills in Settings --------------- */
function renderProfilePills(){
  const wrap=$('profilePillsSettings'); if(!wrap) return;
  const {profiles,activeId}=getProfilesAndActive();
  wrap.innerHTML='';
  profiles.forEach(p=>{
    const b=document.createElement('button');
    b.className='profile-pill'+(p.id===activeId?' active':'');
    b.textContent=p.name||'Profile'; b.onclick=()=>{ localStorage.setItem('activeProfileId',p.id); renderProfilePills(); loadProfileForm(); };
    wrap.appendChild(b);
  });
  const add=document.createElement('button'); add.className='profile-pill add'; add.textContent='+ Add profile';
  add.onclick=()=>{ const arr=getProfiles(); const id='p'+Math.random().toString(36).slice(2,7); arr.push({id,name:'Profile '+(arr.length+1)}); setProfiles(arr); renderProfilePills(); };
  wrap.appendChild(add);
}
function getProfilesAndActive(){
  let arr=getProfiles(); let act=localStorage.getItem('activeProfileId');
  if(!arr.length){ arr=[{id:'p1',name:'Emma',sex:'female'}]; setProfiles(arr); act='p1'; localStorage.setItem('activeProfileId',act); }
  return {profiles:arr,activeId: act || arr[0].id};
}

/* --------------- load form from active profile --------------- */
function loadProfileForm(){
  const p=fromCmIfNeeded(activeProfile());
  $('m_name').value = p.name||'';
  $('m_sex').value = p.sex||'female';
  ['height','bust','waist','hip','thigh','calf','neck','underbust','inseam','arm'].forEach(k=>{
    const el=$('m_'+k); if(el) el.value = p[k]??'';
  });
  updateUnitLabels();
}

/* --------------- MiStats (unchanged logic, style restored) --------------- */
(function(){
  const STORE_KEY='mistats_v2';
  function load(){try{return JSON.parse(localStorage.getItem(STORE_KEY)||'{}')}catch(e){return {}}}
  function save(s){localStorage.setItem(STORE_KEY,JSON.stringify(s))}
  function getBucket(){const S=load();const id=getActiveId(); if(!S[id])S[id]={unitW: localStorage.getItem('weightUnit')||'kg', entries:[],measures:[]}; return {s:S,b:S[id],id}}
  window.getBucket=getBucket;

  function renderCurrent(){
    const {b}=getBucket(); const E=b.entries;
    const box=$('mi_view_current'); if(!box)return;
    if(!E.length){ box.innerHTML='<p class="note">No entries yet</p>'; return; }
    const start=E[0], curr=E[E.length-1];
    const lost=(start.kg-curr.kg).toFixed(1);
    box.innerHTML=`<div class="big">Current weight ${curr.kg}kg</div><p class="note">Start: ${start.kg}kg • Lost: ${lost}kg</p>`;
  }
  function renderHistory(){
    const {b}=getBucket(); const E=b.entries; const box=$('mi_view_history'); if(!box)return;
    box.innerHTML=E.map(e=>`<div class="mi-row"><div>${e.d}</div><div>${e.kg}kg</div></div>`).join('');
  }
  function miDrawGraph(){
    const {b}=getBucket(); const E=b.entries; const c=$('mi_canvas'); const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height);
    if(E.length<2){$('mi_graph_note').textContent='Add 2+ entries to see a line.';return;}
    const min=Math.min(...E.map(e=>e.kg)), max=Math.max(...E.map(e=>e.kg));
    const left=40,top=10,right=10,bottom=20,W=c.width-left-right,H=c.height-top-bottom;
    ctx.strokeStyle='#5da8ff';ctx.beginPath();
    E.forEach((e,i)=>{const x=left+(i/(E.length-1))*W;const y=top+H-(e.kg-min)/(max-min)*H; if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);ctx.moveTo(x,y);ctx.arc(x,y,2,0,Math.PI*2);});
    ctx.stroke(); $('mi_graph_note').textContent=E.length+' points';
  }
  function refreshAll(){renderCurrent();renderHistory();miDrawGraph();}
  window.refreshAll=refreshAll;
})();

/* --------------- settings: merged unit toggles --------------- */
document.addEventListener('click',e=>{
  const wu=e.target.closest('[data-wu]'); if(wu){ localStorage.setItem('weightUnit',wu.dataset.wu); document.querySelectorAll('[data-wu]').forEach(x=>x.classList.remove('active')); wu.classList.add('active'); refreshAll(); }
  const du=e.target.closest('[data-unit]'); if(du){ setLenUnit(du.dataset.unit); document.querySelectorAll('[data-unit]').forEach(x=>x.classList.remove('active')); du.classList.add('active'); updateUnitLabels(); loadProfileForm(); }
});

/* --------------- boot --------------- */
function boot(){
  setupPills();
  renderProfilePills();
  loadProfileForm();
  // mark active buttons in Settings
  const u=getLenUnit(); const wu=localStorage.getItem('weightUnit')||'kg';
  document.querySelectorAll(`[data-unit="${u}"]`).forEach(x=>x.classList.add('active'));
  document.querySelectorAll(`[data-wu="${wu}"]`).forEach(x=>x.classList.add('active'));
  switchTab('home'); // exit splash to home
}
window.addEventListener('load',boot);
</script>
</body>
</html>
