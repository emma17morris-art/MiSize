<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize - Size Finder & Body Tracker</title>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer {
      flex: 1;
    }
    
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header {
      margin-bottom: 40px;
    }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-tile:active {
      transform: translateY(-2px);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover {
      color: var(--brand);
    }
    
    .nav-item.active {
      color: var(--brand);
    }

    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: block;
    }

    .hub-container {
      padding: 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .hub-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .hub-flag {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .hub-title {
      font-size: 36px;
      font-weight: 900;
      margin: 0 0 8px;
    }

    .hub-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin: 0;
    }

    .hub-tiles {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tiles-5 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tiles-5 .hub-tile:last-child {
      grid-column: span 2;
    }

    .hub-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      text-align: center;
      color: #fff;
      font-size: 18px;
      font-weight: 800;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hub-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .form-select {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .btn {
      flex: 1;
      padding: 16px 24px;
      border: 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-secondary {
      background: var(--card);
      color: var(--text);
      border: 2px solid var(--border);
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .stats-bubble {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .stats-bubble.current {
      transform: scale(1.1);
      background: var(--blue);
      color: #fff;
    }

    .stats-bubble h3 {
      margin: 0 0 8px;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .stats-bubble .value {
      font-size: 24px;
      font-weight: 900;
      margin: 0;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: var(--border);
      border-radius: 6px;
      overflow: hidden;
      margin: 24px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--green);
      transition: width 0.3s;
    }

    .mini-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 32px;
    }

    .mini-bubble {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .mini-bubble h4 {
      margin: 0 0 4px;
      font-size: 12px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .mini-bubble .value {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }

    .bmi-indicator {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .stats-tabs {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      padding: 0 20px;
      z-index: 99;
    }

    .stats-tab {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .stats-tab.active {
      color: var(--brand);
      border-bottom: 2px solid var(--brand);
    }

    .graph-controls {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .graph-btn {
      padding: 8px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .graph-btn.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .history-list {
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--border);
    }

    .history-item {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-date {
      font-size: 14px;
      color: var(--muted);
    }

    .help-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .help-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
    }

    .help-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .help-card h4 {
      margin: 0 0 8px;
      color: var(--text);
      font-weight: 800;
    }

    .help-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
    }

    .brand-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .brand-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
    }

    .brand-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .brand-size {
      background: var(--brand);
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
    }

    .guide-section {
      margin-bottom: 24px;
    }

    .guide-section:last-child {
      margin-bottom: 0;
    }

    .guide-section h4 {
      color: var(--brand);
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .guide-section h5 {
      color: var(--text);
      font-size: 16px;
      font-weight: 700;
      margin: 16px 0 8px;
    }

    .guide-section p {
      margin: 0 0 8px;
      line-height: 1.6;
      color: var(--text);
    }

    .guide-section ul {
      margin: 8px 0;
      padding-left: 20px;
      color: var(--text);
    }

    .guide-section li {
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .highlight-tip {
      background: rgba(138, 43, 226, 0.1);
      border-left: 4px solid var(--brand);
      padding: 12px 16px;
      margin: 16px 0;
      border-radius: 0 8px 8px 0;
    }

    .highlight-tip p {
      margin: 0;
      font-weight: 600;
    }

    .step-number {
      background: var(--brand);
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      margin-right: 8px;
    }

    /* Settings Specific Styles */
    .settings-section {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
    }

    .settings-section h3 {
      color: var(--brand);
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 16px;
    }

    .pill-settings-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .settings-pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 12px;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-pill.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .measurement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .measurement-bubble {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s;
    }

    .measurement-bubble:hover {
      border-color: var(--brand);
    }

    .measurement-bubble h4 {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .measurement-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      text-align: center;
      font-weight: 600;
    }

    .profile-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .profile-card:hover {
      border-color: var(--brand);
    }

    .profile-card.active {
      border-color: var(--brand);
      background: rgba(138, 43, 226, 0.1);
    }

    .profile-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .profile-details {
      font-size: 14px;
      color: var(--muted);
    }

    .profile-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--card);
      border: 2px solid var(--brand);
      border-radius: 12px;
      z-index: 10;
      display: none;
      max-height: 300px;
      overflow-y: auto;
    }

    .profile-dropdown.show {
      display: block;
    }

    .profile-option {
      padding: 16px 20px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      transition: background 0.2s;
    }

    .profile-option:last-child {
      border-bottom: none;
    }

    .profile-option:hover {
      background: rgba(138, 43, 226, 0.1);
    }

    .guide-tile {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .guide-tile:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .guide-tile h4 {
      color: var(--brand);
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 12px;
    }

    .guide-content {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    .guide-content.show {
      display: block;
    }

    .profile-data-view {
      background: var(--bg);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
      border: 1px solid var(--border);
    }

    .data-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 14px;
    }

    .data-label {
      color: var(--muted);
    }

    .data-value {
      color: var(--text);
      font-weight: 600;
    }

    /* Size Result Display */
    .size-result {
      background: var(--green);
      color: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
      font-weight: 800;
      font-size: 18px;
      display: none;
    }

    .size-result.show {
      display: block;
    }

    .measurement-display {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .measurement-display h4 {
      margin: 0 0 12px;
      color: var(--brand);
      font-size: 16px;
    }

    .measurement-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .measurement-row:last-child {
      margin-bottom: 0;
    }

    .category-filter {
      margin-bottom: 20px;
    }

    .filter-pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-pill {
      padding: 8px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--text);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-pill.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .no-measurements-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 2px solid var(--orange);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
    }

    .no-measurements-warning h4 {
      color: var(--orange);
      margin: 0 0 8px;
    }

    .no-measurements-warning p {
      margin: 0;
      color: var(--text);
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize</div>
      
      <div class="pill-group">
        <button class="pill active" data-type="standard">Std</button>
        <button class="pill" data-type="petite">Petite</button>
        <button class="pill" data-type="tall">Tall</button>
        <button class="pill" data-type="plus">Plus</button>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize</h1>
        <p class="subtitle">Your personal size finder and body tracker</p>
      </div>
      
      <div class="region-grid">
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">🇬🇧</span>
          <h3 class="region-name">UK</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('EU')">
          <span class="region-flag">🇪🇺</span>
          <h3 class="region-name">EU</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('US')">
          <span class="region-flag">🇺🇸</span>
          <h3 class="region-name">US</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('CA')">
          <span class="region-flag">🇨🇦</span>
          <h3 class="region-name">CA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Screen -->
  <div id="help" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">Help & Support</h2>
        <p class="hub-subtitle">Get started and find answers to your questions</p>
      </div>

      <p style="text-align: center; margin-bottom: 32px; color: var(--muted);">
        👋 <strong>New to MiSize?</strong> Go to Settings first to create your profile, then follow the guidance below.
      </p>
      
      <!-- How to Use MiSize Tile -->
      <div class="guide-tile" onclick="toggleGuide('app-guide')">
        <h4>📱 How to Use MiSize - Complete Guide</h4>
        <p style="margin: 0; color: var(--muted);">Step-by-step instructions for using all features</p>
        
        <div id="app-guide" class="guide-content">
          <div class="guide-section">
            <h5><span class="step-number">1</span>Getting Started</h5>
            <p>Welcome to MiSize! Start by selecting your region (UK, EU, US, CA) from the home screen to access region-specific sizing and brands.</p>
            
            <div class="highlight-tip">
              <p><strong>💡 Tip:</strong> Choose the region where you shop most frequently for the most accurate sizing information.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Report Issues Tile -->
      <div class="guide-tile" onclick="reportIssue()">
        <h4>🐛 Report Issues & Feedback</h4>
        <p style="margin: 0; color: var(--muted);">Found wrong sizes, app bugs, or have suggestions? Let us know!</p>
      </div>

      <!-- Measurement Guides Section -->
      <h3 style="text-align: center; margin: 32px 0 24px;">Measurement Guides</h3>
      
      <div class="help-grid">
        <div class="help-card" onclick="showMeasurementGuide('women')">
          <h4>Women's Measurements</h4>
          <p>Complete guide for taking accurate body measurements</p>
        </div>
        <div class="help-card" onclick="showMeasurementGuide('men')">
          <h4>Men's Measurements</h4>
          <p>Essential measurements for men's clothing</p>
        </div>
        <div class="help-card" onclick="showMeasurementGuide('children')">
          <h4>Children's Guide</h4>
          <p>How to measure children and teens</p>
        </div>
        <div class="help-card" onclick="showMeasurementGuide('foot')">
          <h4>Foot Measuring</h4>
          <p>Get accurate foot measurements for shoes</p>
        </div>
      </div>
    </div>
  </div>

  <!-- UK Hub -->
  <div id="uk-hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">🇬🇧</div>
        <h2 class="hub-title">UK Hub</h2>
        <p class="hub-subtitle">United Kingdom sizing & tracking</p>
      </div>
      
      <div class="hub-tiles-5">
        <div class="hub-tile" onclick="goToScreen('uk-sizefinder')">
          Size Finder
        </div>
        <div class="hub-tile" onclick="goToScreen('uk-mysizes')">
          My Sizes
        </div>
        <div class="hub-tile" onclick="goToScreen('uk-brandnotes')">
          Brand Notes
        </div>
        <div class="hub-tile" onclick="goToScreen('uk-history')">
          History
        </div>
        <div class="hub-tile" onclick="goToScreen('uk-converters')">
          Converters
        </div>
      </div>
    </div>
  </div>

  <!-- UK Size Finder -->
  <div id="uk-sizefinder" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Size Finder</h2>
        <p class="hub-subtitle">Find your perfect size across UK brands</p>
      </div>
      
      <div class="form-container">
        <!-- Current Measurements Display -->
        <div id="current-measurements" class="measurement-display">
          <h4>📏 Your Current Measurements</h4>
          <!-- This will be populated with current profile measurements -->
        </div>
        
        <div class="form-group">
          <label class="form-label">Brand</label>
          <select class="form-select" id="uk-brand-select">
            <option value="">Select a brand...</option>
            <option value="ASOS">ASOS</option>
            <option value="Next">Next</option>
            <option value="Marks & Spencer">Marks & Spencer</option>
            <option value="Zara">Zara</option>
            <option value="H&M">H&M</option>
            <option value="Topshop">Topshop</option>
            <option value="Primark">Primark</option>
            <option value="Uniqlo">Uniqlo</option>
            <option value="COS">COS</option>
            <option value="& Other Stories">& Other Stories</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="uk-category-select">
            <option value="">Select category...</option>
            <option value="Women's Jeans">Women's Jeans</option>
            <option value="Women's Dresses">Women's Dresses</option>
            <option value="Women's Tops">Women's Tops</option>
            <option value="Women's Shoes">Women's Shoes</option>
            <option value="Men's Jeans">Men's Jeans</option>
            <option value="Men's Shirts">Men's Shirts</option>
            <option value="Men's Shoes">Men's Shoes</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Fit Preference</label>
          <select class="form-select" id="uk-fit-select">
            <option value="">Select fit...</option>
            <option value="Standard">Standard</option>
            <option value="Snug">Snug (Size down)</option>
            <option value="Relaxed">Relaxed (Size up)</option>
          </select>
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="getMySize()">Get My Size</button>
          <button class="btn btn-secondary" onclick="saveToHistory()">Save to History</button>
        </div>
        
        <!-- Size Result Display -->
        <div id="size-result" class="size-result">
          <!-- Size recommendation will appear here -->
        </div>
      </div>
    </div>
  </div>

  <!-- UK My Sizes -->
  <div id="uk-mysizes" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">My Sizes</h2>
        <p class="hub-subtitle">(Filtered by <span id="body-type-display">Standard</span> body type)</p>
        <p style="font-size: 14px; color: var(--muted); margin-top: 8px;">
          Based on your current measurements
        </p>
      </div>
      
      <!-- Category Filter -->
      <div class="category-filter">
        <div class="filter-pills">
          <button class="filter-pill active" onclick="filterMySizes('all')">All</button>
          <button class="filter-pill" onclick="filterMySizes('jeans')">Jeans</button>
          <button class="filter-pill" onclick="filterMySizes('dresses')">Dresses</button>
          <button class="filter-pill" onclick="filterMySizes('tops')">Tops</button>
          <button class="filter-pill" onclick="filterMySizes('shoes')">Shoes</button>
        </div>
      </div>
      
      <div class="brand-grid" id="my-sizes-grid">
        <!-- This will be populated with profile-specific brand sizes -->
      </div>
    </div>
  </div>

  <!-- UK History -->
  <div id="uk-history" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Search History</h2>
        <p class="hub-subtitle">Your past size finder searches</p>
      </div>
      
      <div class="history-list" id="uk-history-list">
        <!-- This will be populated with profile-specific history -->
      </div>
    </div>
  </div>

  <!-- UK Brand Notes -->
  <div id="uk-brandnotes" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Brand Notes</h2>
        <p class="hub-subtitle">Information about UK brands and their sizing</p>
      </div>
      
      <div class="brand-grid">
        <div class="brand-card">
          <div class="brand-name">ASOS</div>
          <p><strong>Sizing:</strong> UK sizes, runs slightly large</p>
          <p><strong>Body Types:</strong> Standard, Petite, Tall, Plus</p>
          <p><strong>Categories:</strong> Full range including jeans, dresses, tops, shoes</p>
          <p><strong>Note:</strong> Online exclusive, good size range</p>
        </div>
        <div class="brand-card">
          <div class="brand-name">Zara</div>
          <p><strong>Sizing:</strong> European sizes, runs small</p>
          <p><strong>Body Types:</strong> Standard, Limited plus sizes</p>
          <p><strong>Categories:</strong> Dresses, tops, jeans, shoes</p>
          <p><strong>Note:</strong> Trend-focused, size up recommended</p>
        </div>
        <div class="brand-card">
          <div class="brand-name">Marks & Spencer</div>
          <p><strong>Sizing:</strong> UK sizes, true to size</p>
          <p><strong>Body Types:</strong> Standard, Petite, Tall, Plus</p>
          <p><strong>Categories:</strong> Full range, excellent basics</p>
          <p><strong>Note:</strong> Reliable sizing, good quality</p>
        </div>
      </div>
    </div>
  </div>

  <!-- UK Converters -->
  <div id="uk-converters" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Size Converters</h2>
        <p class="hub-subtitle">Convert between UK, US, CA, EU sizes</p>
      </div>
      
      <div class="hub-tiles">
        <div class="hub-tile" onclick="openConverter('dresses')">
          Dress Sizes
        </div>
        <div class="hub-tile" onclick="openConverter('jeans')">
          Jean Sizes
        </div>
        <div class="hub-tile" onclick="openConverter('tops')">
          Top Sizes
        </div>
        <div class="hub-tile" onclick="openConverter('shoes')">
          Shoe Sizes
        </div>
        <div class="hub-tile" onclick="openConverter('bra')">
          Bra Helper
        </div>
      </div>
    </div>
  </div>

  <!-- UK Settings -->
  <div id="uk-settings" class="screen">
    <div class="content-container">
      <div class="hub-header">
        <h2 class="hub-title">🇬🇧 Settings</h2>
        <p class="hub-subtitle">Manage your profiles and preferences</p>
      </div>

      <!-- Profiles Section -->
      <div class="settings-section">
        <h3>👤 Profiles</h3>
        <p style="margin-bottom: 16px; color: var(--muted);">Create and manage multiple user profiles</p>
        
        <div class="profile-card active" onclick="toggleProfileDropdown()">
          <div class="profile-name" id="active-profile-name">Emma Thompson</div>
          <div class="profile-details" id="active-profile-details">Standard • 5'6" • UK Sizes • Active Profile</div>
          
          <div class="profile-dropdown" id="profile-dropdown">
            <!-- Profile options will be populated here -->
          </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="new-profile-name" placeholder="Enter profile name" />
        </div>
        
        <div class="form-group">
          <label class="form-label">Body Type</label>
          <select class="form-select" id="new-profile-body-type">
            <option>Standard</option>
            <option>Petite</option>
            <option>Tall</option>
            <option>Plus Size</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Height</label>
          <input type="text" class="form-input" id="new-profile-height" placeholder="5'6&quot; or 168cm" />
        </div>

        <button class="btn btn-primary" style="width: 100%;" onclick="saveProfile()">Save Profile</button>
      </div>

      <!-- Measurements Section -->
      <div class="settings-section">
        <h3>📏 Measurements & Weights</h3>
        <p style="margin-bottom: 16px; color: var(--muted);">Track your body measurements for accurate sizing</p>

        <div class="measurement-grid">
          <div class="measurement-bubble">
            <h4>Weight</h4>
            <input type="number" class="measurement-input" id="weight" placeholder="62" />
          </div>
          <div class="measurement-bubble">
            <h4>Chest/Bust</h4>
            <input type="number" class="measurement-input" id="chest" placeholder="86" />
          </div>
          <div class="measurement-bubble">
            <h4>Waist</h4>
            <input type="number" class="measurement-input" id="waist" placeholder="68" />
          </div>
          <div class="measurement-bubble">
            <h4>Hips</h4>
            <input type="number" class="measurement-input" id="hips" placeholder="92" />
          </div>
          <div class="measurement-bubble">
            <h4>Shoulders</h4>
            <input type="number" class="measurement-input" id="shoulders" placeholder="38" />
          </div>
          <div class="measurement-bubble">
            <h4>Arms</h4>
            <input type="number" class="measurement-input" id="arms" placeholder="28" />
          </div>
          <div class="measurement-bubble">
            <h4>Thighs</h4>
            <input type="number" class="measurement-input" id="thighs" placeholder="56" />
          </div>
          <div class="measurement-bubble">
            <h4>Inseam</h4>
            <input type="number" class="measurement-input" id="inseam" placeholder="76" />
          </div>
          <div class="measurement-bubble">
            <h4>Neck</h4>
            <input type="number" class="measurement-input" id="neck" placeholder="32" />
          </div>
        </div>

        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="saveMeasurements()">Save Measurements</button>
      </div>
    </div>
  </div>

  <!-- MiStats Screen -->
  <div id="mistats" class="screen">
    <div class="stats-tabs">
      <button class="stats-tab active" onclick="showStatsTab('current')">Current</button>
      <button class="stats-tab" onclick="showStatsTab('graph')">Graph</button>
      <button class="stats-tab" onclick="showStatsTab('history')">History</button>
    </div>
    
    <!-- Current Progress Tab -->
    <div id="stats-current" class="stats-content active" style="padding-top: 120px;">
      <div class="content-container">
        <div class="hub-header">
          <h2 class="hub-title">Welcome back, <span id="user-name">Emma</span>!</h2>
        </div>
        
        <div class="stats-grid">
          <div class="stats-bubble">
            <h3>Start</h3>
            <p class="value" id="start-weight">--</p>
          </div>
          <div class="stats-bubble current">
            <h3>Current</h3>
            <p class="value" id="current-weight">--</p>
          </div>
          <div class="stats-bubble">
            <h3>Target</h3>
            <p class="value" id="target-weight">--</p>
          </div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
        </div>
        <p style="text-align: center; margin-bottom: 32px;" id="progress-text">Set goals to track progress</p>
        
        <h3 style="text-align: center; margin-bottom: 16px;">Current Statistics</h3>
        <div class="mini-stats">
          <div class="mini-bubble">
            <h4>Body Fat %</h4>
            <p class="value" id="body-fat">--</p>
          </div>
          <div class="mini-bubble">
            <h4>Amount Lost</h4>
            <p class="value" id="amount-lost">--</p>
          </div>
          <div class="mini-bubble">
            <h4>Remaining</h4>
            <p class="value" id="remaining-weight">--</p>
          </div>
        </div>
        
        <div class="bmi-indicator">
          <h4>BMI Tracker</h4>
          <p class="value" style="color: var(--green);" id="bmi-value">--</p>
          <p style="font-size: 14px; margin-top: 8px;" id="bmi-category">Calculate BMI</p>
        </div>
      </div>
    </div>

    <!-- Graph Tab -->
    <div id="stats-graph" class="stats-content" style="display: none; padding-top: 120px;">
      <div class="content-container">
        <div class="graph-controls">
          <button class="graph-btn active">Week</button>
          <button class="graph-btn">Month</button>
          <button class="graph-btn">Year</button>
          <button class="graph-btn">Table</button>
        </div>
        <div style="background: var(--card); border-radius: 12px; padding: 40px; text-align: center; border: 2px solid var(--border);">
          <p>📊 Graph visualization will be displayed here</p>
          <p style="color: var(--muted); font-size: 14px;">Interactive chart with zoom capabilities</p>
        </div>
      </div>
    </div>

    <!-- History Tab -->
    <div id="stats-history" class="stats-content" style="display: none; padding-top: 120px;">
      <div class="content-container">
        <h3>Measurement History</h3>
        <div class="history-list" id="measurement-history">
          <!-- Profile-specific measurement history will be displayed here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Other region screens (simplified) -->
  <div id="eu-hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">🇪🇺</div>
        <h2 class="hub-title">EU Hub</h2>
        <p class="hub-subtitle">European sizing & tracking</p>
      </div>
      
      <div class="hub-tiles-5">
        <div class="hub-tile" onclick="alert('EU Size Finder coming soon!')">Size Finder</div>
        <div class="hub-tile" onclick="alert('EU My Sizes coming soon!')">My Sizes</div>
        <div class="hub-tile" onclick="alert('EU Brand Notes coming soon!')">Brand Notes</div>
        <div class="hub-tile" onclick="alert('EU History coming soon!')">History</div>
        <div class="hub-tile" onclick="alert('EU Converters coming soon!')">Converters</div>
      </div>
    </div>
  </div>

  <div id="us-hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">🇺🇸</div>
        <h2 class="hub-title">US Hub</h2>
        <p class="hub-subtitle">United States sizing & tracking</p>
      </div>
      
      <div class="hub-tiles-5">
        <div class="hub-tile" onclick="alert('US Size Finder coming soon!')">Size Finder</div>
        <div class="hub-tile" onclick="alert('US My Sizes coming soon!')">My Sizes</div>
        <div class="hub-tile" onclick="alert('US Brand Notes coming soon!')">Brand Notes</div>
        <div class="hub-tile" onclick="alert('US History coming soon!')">History</div>
        <div class="hub-tile" onclick="alert('US Converters coming soon!')">Converters</div>
      </div>
    </div>
  </div>

  <div id="ca-hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">🇨🇦</div>
        <h2 class="hub-title">Canada Hub</h2>
        <p class="hub-subtitle">Canadian sizing & tracking</p>
      </div>
      
      <div class="hub-tiles-5">
        <div class="hub-tile" onclick="alert('CA Size Finder coming soon!')">Size Finder</div>
        <div class="hub-tile" onclick="alert('CA My Sizes coming soon!')">My Sizes</div>
        <div class="hub-tile" onclick="alert('CA Brand Notes coming soon!')">Brand Notes</div>
        <div class="hub-tile" onclick="alert('CA History coming soon!')">History</div>
        <div class="hub-tile" onclick="alert('CA Converters coming soon!')">Converters</div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="goHome()">Home</button>
    <button class="nav-item" onclick="goToMiStats()">MiStats</button>
    <button class="nav-item" onclick="goToSettings()">Settings</button>
    <button class="nav-item" onclick="goToHelp()">Help</button>
    <button class="nav-item" onclick="goBack()">Back</button>
  </div>

  <script>
    // Global variables
    let currentScreen = 'home';
    let navigationHistory = [];
    let selectedBodyType = 'standard';
    let selectedUnit = 'cm';
    let currentProfile = 'Emma Thompson';
    let currentFilter = 'all';
    
    // Enhanced profile data with brand-specific sizing algorithms
    let profileData = {
      'Emma Thompson': {
        id: 'emma-thompson',
        name: 'Emma Thompson',
        bodyType: 'Standard',
        height: "5'6\"",
        region: 'UK',
        details: 'Standard • 5\'6" • UK Sizes • Active Profile',
        measurements: {
          weight: 62,
          chest: 86,
          waist: 68,
          hips: 92,
          shoulders: 38,
          arms: 28,
          thighs: 56,
          inseam: 76,
          neck: 32
        },
        goals: {
          startWeight: 65,
          targetWeight: 58,
          bodyFat: 22
        },
        brandSizes: {},
        searchHistory: [
          { brand: 'ASOS', category: 'Women\'s Jeans', size: 'Size 10', fit: 'Standard', date: '2 days ago' },
          { brand: 'Zara', category: 'Women\'s Dresses', size: 'Size M', fit: 'Standard', date: '1 week ago' }
        ],
        measurementHistory: [
          { type: 'Weight', value: '62kg', date: 'March 15, 2024' },
          { type: 'Waist', value: '68cm', date: 'March 15, 2024' }
        ]
      }
    };

    // Brand-specific sizing algorithms
    const brandSizingAlgorithms = {
      'ASOS': {
        'Women\'s Jeans': (measurements) => {
          if (measurements.waist <= 60) return 'Size 6';
          if (measurements.waist <= 65) return 'Size 8';
          if (measurements.waist <= 70) return 'Size 10';
          if (measurements.waist <= 75) return 'Size 12';
          if (measurements.waist <= 80) return 'Size 14';
          return 'Size 16';
        },
        'Women\'s Dresses': (measurements) => {
          if (measurements.chest <= 81 && measurements.waist <= 63) return 'Size XS';
          if (measurements.chest <= 86 && measurements.waist <= 68) return 'Size S';
          if (measurements.chest <= 91 && measurements.waist <= 73) return 'Size M';
          if (measurements.chest <= 96 && measurements.waist <= 78) return 'Size L';
          return 'Size XL';
        },
        'Women\'s Tops': (measurements) => {
          if (measurements.chest <= 81) return 'Size XS';
          if (measurements.chest <= 86) return 'Size S';
          if (measurements.chest <= 91) return 'Size M';
          if (measurements.chest <= 96) return 'Size L';
          return 'Size XL';
        },
        'Women\'s Shoes': (measurements) => {
          // Placeholder - would need foot measurements
          return 'Size 6 UK';
        }
      },
      'Zara': {
        'Women\'s Jeans': (measurements) => {
          // Zara runs small, so size up
          if (measurements.waist <= 58) return 'Size 34 (XS)';
          if (measurements.waist <= 63) return 'Size 36 (S)';
          if (measurements.waist <= 68) return 'Size 38 (M)';
          if (measurements.waist <= 73) return 'Size 40 (L)';
          return 'Size 42 (XL)';
        },
        'Women\'s Dresses': (measurements) => {
          if (measurements.chest <= 84 && measurements.waist <= 66) return 'Size S';
          if (measurements.chest <= 89 && measurements.waist <= 71) return 'Size M';
          if (measurements.chest <= 94 && measurements.waist <= 76) return 'Size L';
          return 'Size XL';
        },
        'Women\'s Tops': (measurements) => {
          if (measurements.chest <= 84) return 'Size S';
          if (measurements.chest <= 89) return 'Size M';
          if (measurements.chest <= 94) return 'Size L';
          return 'Size XL';
        }
      },
      'H&M': {
        'Women\'s Jeans': (measurements) => {
          if (measurements.waist <= 62) return 'Size 34';
          if (measurements.waist <= 67) return 'Size 36';
          if (measurements.waist <= 72) return 'Size 38';
          if (measurements.waist <= 77) return 'Size 40';
          return 'Size 42';
        },
        'Women\'s Dresses': (measurements) => {
          if (measurements.chest <= 82 && measurements.waist <= 64) return 'Size XS';
          if (measurements.chest <= 87 && measurements.waist <= 69) return 'Size S';
          if (measurements.chest <= 92 && measurements.waist <= 74) return 'Size M';
          if (measurements.chest <= 97 && measurements.waist <= 79) return 'Size L';
          return 'Size XL';
        }
      },
      'Next': {
        'Women\'s Jeans': (measurements) => {
          if (measurements.waist <= 63) return 'Size 8';
          if (measurements.waist <= 68) return 'Size 10';
          if (measurements.waist <= 73) return 'Size 12';
          if (measurements.waist <= 78) return 'Size 14';
          return 'Size 16';
        },
        'Women\'s Dresses': (measurements) => {
          if (measurements.chest <= 84 && measurements.waist <= 66) return 'Size 8';
          if (measurements.chest <= 89 && measurements.waist <= 71) return 'Size 10';
          if (measurements.chest <= 94 && measurements.waist <= 76) return 'Size 12';
          if (measurements.chest <= 99 && measurements.waist <= 81) return 'Size 14';
          return 'Size 16';
        }
      },
      'Marks & Spencer': {
        'Women\'s Jeans': (measurements) => {
          if (measurements.waist <= 63) return 'Size 8';
          if (measurements.waist <= 68) return 'Size 10';
          if (measurements.waist <= 73) return 'Size 12';
          if (measurements.waist <= 78) return 'Size 14';
          return 'Size 16';
        },
        'Women\'s Dresses': (measurements) => {
          if (measurements.chest <= 84 && measurements.waist <= 66) return 'Size 8';
          if (measurements.chest <= 89 && measurements.waist <= 71) return 'Size 10';
          if (measurements.chest <= 94 && measurements.waist <= 76) return 'Size 12';
          return 'Size 14';
        }
      }
    };

    // Initialize app
    function initApp() {
      updateScreenData('home');
      updateNavigation();
      setupPillEventListeners();
      setupClickOutsideListener();
    }

    // Navigation functions
    function enterHub(region) {
      const hubScreen = region.toLowerCase() + '-hub';
      goToScreen(hubScreen);
    }
    
    function goToScreen(screenId) {
      if (currentScreen !== screenId) {
        navigationHistory.push(currentScreen);
      }
      
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      const targetScreen = document.getElementById(screenId);
      if (targetScreen) {
        targetScreen.classList.add('active');
        currentScreen = screenId;
        updateScreenData(screenId);
        updateNavigation();
      }
    }
    
    function updateScreenData(screenId) {
      const profile = profileData[currentProfile];
      
      if (screenId === 'mistats') {
        updateMiStatsData(profile);
      } else if (screenId === 'uk-mysizes') {
        updateMySizesData(profile);
      } else if (screenId === 'uk-history') {
        updateHistoryData(profile);
      } else if (screenId === 'uk-settings') {
        loadProfileMeasurements(profile);
      } else if (screenId === 'uk-sizefinder') {
        displayCurrentMeasurements(profile);
      }
    }

    function displayCurrentMeasurements(profile) {
      const measurementDisplay = document.getElementById('current-measurements');
      if (measurementDisplay) {
        const measurements = profile.measurements;
        const hasMeasurements = Object.values(measurements).some(val => val !== null && val !== undefined);
        
        if (!hasMeasurements) {
          measurementDisplay.innerHTML = `
            <div class="no-measurements-warning">
              <h4>⚠️ No Measurements Found</h4>
              <p>Go to Settings to add your measurements for accurate size recommendations.</p>
            </div>
          `;
          return;
        }

        measurementDisplay.innerHTML = `
          <h4>📏 Your Current Measurements (${currentProfile})</h4>
          <div class="measurement-row">
            <span>Weight:</span>
            <span>${measurements.weight || '--'} kg</span>
          </div>
          <div class="measurement-row">
            <span>Chest/Bust:</span>
            <span>${measurements.chest || '--'} cm</span>
          </div>
          <div class="measurement-row">
            <span>Waist:</span>
            <span>${measurements.waist || '--'} cm</span>
          </div>
          <div class="measurement-row">
            <span>Hips:</span>
            <span>${measurements.hips || '--'} cm</span>
          </div>
          <div class="measurement-row">
            <span>Height:</span>
            <span>${profile.height}</span>
          </div>
        `;
      }
    }

    // Enhanced size finder function
    function getMySize() {
      const brand = document.getElementById('uk-brand-select')?.value;
      const category = document.getElementById('uk-category-select')?.value;
      const fit = document.getElementById('uk-fit-select')?.value;
      const resultDiv = document.getElementById('size-result');
      
      if (!brand || !category || !fit) {
        alert('Please select all options to find your size.');
        return;
      }

      const profile = profileData[currentProfile];
      const measurements = profile.measurements;
      
      // Check if measurements exist
      const hasMeasurements = Object.values(measurements).some(val => val !== null && val !== undefined);
      if (!hasMeasurements) {
        alert('Please add your measurements in Settings first for accurate size recommendations.');
        return;
      }

      // Get size using brand-specific algorithm
      let size = 'Size not available';
      if (brandSizingAlgorithms[brand] && brandSizingAlgorithms[brand][category]) {
        size = brandSizingAlgorithms[brand][category](measurements);
        
        // Apply fit preference
        if (fit === 'Snug') {
          size += ' (Consider sizing down for snug fit)';
        } else if (fit === 'Relaxed') {
          size += ' (Consider sizing up for relaxed fit)';
        }
      } else {
        // Fallback generic sizing
        size = getGenericSize(category, measurements);
      }

      // Display result
      if (resultDiv) {
        resultDiv.innerHTML = `
          <strong>${brand}</strong> ${category}<br>
          Recommended Size: <strong>${size}</strong><br>
          Fit: ${fit}
        `;
        resultDiv.classList.add('show');
      }

      // Save to profile
      if (!profile.brandSizes[brand]) {
        profile.brandSizes[brand] = {};
      }
      profile.brandSizes[brand][category] = { size, fit, date: new Date().toLocaleDateString() };
      
      // Add to history
      profile.searchHistory.unshift({
        brand,
        category,
        size,
        fit,
        date: 'Just now'
      });

      // Update displays if viewing those screens
      if (currentScreen === 'uk-mysizes') updateMySizesData(profile);
      if (currentScreen === 'uk-history') updateHistoryData(profile);
    }

    function getGenericSize(category, measurements) {
      if (category.includes('Jeans')) {
        if (measurements.waist <= 63) return 'Size 8/XS';
        if (measurements.waist <= 68) return 'Size 10/S';
        if (measurements.waist <= 73) return 'Size 12/M';
        if (measurements.waist <= 78) return 'Size 14/L';
        return 'Size 16/XL';
      } else if (category.includes('Dress') || category.includes('Top')) {
        if (measurements.chest <= 84) return 'Size S';
        if (measurements.chest <= 89) return 'Size M';
        if (measurements.chest <= 94) return 'Size L';
        return 'Size XL';
      } else if (category.includes('Shoe')) {
        return 'Size 6 UK (Add foot measurements for accuracy)';
      }
      return 'Size M (Generic)';
    }

    function updateMySizesData(profile) {
      const grid = document.getElementById('my-sizes-grid');
      if (!grid) return;

      // Generate sizes for all major brands
      const allBrands = Object.keys(brandSizingAlgorithms);
      const categories = ['Women\'s Jeans', 'Women\'s Dresses', 'Women\'s Tops', 'Women\'s Shoes'];
      
      const brandSizeData = [];
      
      allBrands.forEach(brand => {
        categories.forEach(category => {
          if (currentFilter === 'all' || 
              (currentFilter === 'jeans' && category.includes('Jeans')) ||
              (currentFilter === 'dresses' && category.includes('Dresses')) ||
              (currentFilter === 'tops' && category.includes('Tops')) ||
              (currentFilter === 'shoes' && category.includes('Shoes'))) {
            
            let size = 'Add measurements';
            const measurements = profile.measurements;
            const hasMeasurements = Object.values(measurements).some(val => val !== null);
            
            if (hasMeasurements && brandSizingAlgorithms[brand][category]) {
              size = brandSizingAlgorithms[brand][category](measurements);
            }
            
            brandSizeData.push({
              brand,
              category,
              size
            });
          }
        });
      });

      if (brandSizeData.length === 0) {
        grid.innerHTML = '<p style="grid-column: span 2; text-align: center; color: var(--muted);">No sizes for selected filter.</p>';
        return;
      }

      grid.innerHTML = brandSizeData.map(item => `
        <div class="brand-card">
          <div class="brand-name">${item.brand}</div>
          <div class="brand-size">${item.size}</div>
          <p style="font-size: 14px; color: var(--muted); margin-top: 8px;">${item.category}</p>
        </div>
      `).join('');
    }

    function filterMySizes(filter) {
      currentFilter = filter;
      
      // Update active filter pill
      document.querySelectorAll('.filter-pill').forEach(pill => {
        pill.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Update displayed sizes
      updateMySizesData(profileData[currentProfile]);
    }
    
    function updateHistoryData(profile) {
      const historyList = document.getElementById('uk-history-list');
      if (historyList) {
        if (profile.searchHistory.length === 0) {
          historyList.innerHTML = '<p style="text-align: center; color: var(--muted); padding: 40px;">No search history yet</p>';
        } else {
          historyList.innerHTML = profile.searchHistory.map(item => `
            <div class="history-item">
              <div>
                <strong>${item.brand} - ${item.category}</strong><br>
                <span class="history-date">${item.size}, ${item.fit} fit - ${item.date}</span>
              </div>
            </div>
          `).join('');
        }
      }
    }

    function updateMiStatsData(profile) {
      document.getElementById('user-name').textContent = profile.name.split(' ')[0];
      document.getElementById('start-weight').textContent = profile.goals.startWeight + 'kg';
      document.getElementById('current-weight').textContent = profile.measurements.weight + 'kg';
      document.getElementById('target-weight').textContent = profile.goals.targetWeight + 'kg';
      
      const lost = profile.goals.startWeight - profile.measurements.weight;
      const remaining = profile.measurements.weight - profile.goals.targetWeight;
      const progress = (lost / (profile.goals.startWeight - profile.goals.targetWeight)) * 100;
      
      document.getElementById('amount-lost').textContent = lost + 'kg';
      document.getElementById('remaining-weight').textContent = remaining + 'kg';
      document.getElementById('body-fat').textContent = profile.goals.bodyFat + '%';
      document.getElementById('progress-fill').style.width = Math.min(progress, 100) + '%';
      document.getElementById('progress-text').textContent = Math.round(progress) + '% to goal';
      
      // Calculate BMI
      const heightInM = profile.height === "5'6\"" ? 1.68 : profile.height === "6'0\"" ? 1.83 : 1.57;
      const bmi = profile.measurements.weight / (heightInM * heightInM);
      document.getElementById('bmi-value').textContent = bmi.toFixed(1);
      
      let bmiCategory = 'Normal Weight';
      if (bmi < 18.5) bmiCategory = 'Underweight';
      else if (bmi > 25) bmiCategory = 'Overweight';
      document.getElementById('bmi-category').textContent = bmiCategory;
      
      // Update measurement history
      const historyContainer = document.getElementById('measurement-history');
      if (historyContainer) {
        historyContainer.innerHTML = profile.measurementHistory.map(item => `
          <div class="history-item">
            <div>
              <strong>${item.type}: ${item.value}</strong><br>
              <span class="history-date">${item.date}</span>
            </div>
          </div>
        `).join('') || '<p style="text-align: center; color: var(--muted); padding: 40px;">No measurement history yet</p>';
      }
    }
    
    function loadProfileMeasurements(profile) {
      Object.entries(profile.measurements).forEach(([key, value]) => {
        const input = document.getElementById(key);
        if (input) {
          input.value = value || '';
        }
      });
    }
    
    // Navigation functions
    function goHome() {
      navigationHistory = [];
      goToScreen('home');
    }
    
    function goToMiStats() {
      goToScreen('mistats');
    }
    
    function goToSettings() {
      const settingsScreens = {
        'uk': 'uk-settings',
        'eu': 'eu-settings',
        'us': 'us-settings',
        'ca': 'ca-settings'
      };
      
      let targetSettings = 'uk-settings';
      for (let region in settingsScreens) {
        if (currentScreen.includes(region)) {
          targetSettings = settingsScreens[region];
          break;
        }
      }
      
      goToScreen(targetSettings);
    }

    function goToHelp() {
      goToScreen('help');
    }
    
    function goBack() {
      if (navigationHistory.length > 0) {
        const previousScreen = navigationHistory.pop();
        
        document.querySelectorAll('.screen').forEach(screen => {
          screen.classList.remove('active');
        });
        
        const targetScreen = document.getElementById(previousScreen);
        if (targetScreen) {
          targetScreen.classList.add('active');
          currentScreen = previousScreen;
          updateScreenData(previousScreen);
          updateNavigation();
        }
      }
    }
    
    function updateNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (currentScreen === 'home') {
        document.querySelector('.nav-item[onclick="goHome()"]')?.classList.add('active');
      } else if (currentScreen === 'mistats') {
        document.querySelector('.nav-item[onclick="goToMiStats()"]')?.classList.add('active');
      } else if (currentScreen === 'help') {
        document.querySelector('.nav-item[onclick="goToHelp()"]')?.classList.add('active');
      }
    }

    // MiStats functions
    function showStatsTab(tabName) {
      document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.stats-content').forEach(content => {
        content.style.display = 'none';
      });
      
      const activeTab = document.querySelector(`[onclick="showStatsTab('${tabName}')"]`);
      const activeContent = document.getElementById(`stats-${tabName}`);
      
      if (activeTab) activeTab.classList.add('active');
      if (activeContent) activeContent.style.display = 'block';
    }

    function saveToHistory() {
      const brand = document.getElementById('uk-brand-select')?.value;
      const category = document.getElementById('uk-category-select')?.value;
      const fit = document.getElementById('uk-fit-select')?.value;
      
      if (brand && category && fit) {
        const profile = profileData[currentProfile];
        profile.searchHistory.unshift({ 
          brand, 
          category, 
          size: 'Saved search', 
          fit, 
          date: 'Just now' 
        });
        alert('Search saved to history!');
        if (currentScreen === 'uk-history') updateHistoryData(profile);
      } else {
        alert('Please complete your search first.');
      }
    }

    // Profile management functions
    function toggleProfileDropdown() {
      const dropdown = document.getElementById('profile-dropdown');
      if (dropdown) {
        dropdown.classList.toggle('show');
        
        if (dropdown.classList.contains('show')) {
          dropdown.innerHTML = Object.keys(profileData).map(profileName => {
            const profile = profileData[profileName];
            return `
              <div class="profile-option" onclick="switchProfile('${profileName}')">
                <div style="font-weight: 700;">${profileName}</div>
                <div style="font-size: 12px; color: var(--muted);">${profile.details}</div>
              </div>
            `;
          }).join('') + 
          '<div class="profile-option" onclick="createNewProfile()">+ Create New Profile</div>';
        }
      }
    }

    function switchProfile(profileName) {
      if (profileData[profileName]) {
        currentProfile = profileName;
        const profile = profileData[profileName];
        
        const profileNameElement = document.getElementById('active-profile-name');
        const profileDetailsElement = document.getElementById('active-profile-details');
        const dropdown = document.getElementById('profile-dropdown');
        
        if (profileNameElement) profileNameElement.textContent = profileName;
        if (profileDetailsElement) profileDetailsElement.textContent = profile.details;
        if (dropdown) dropdown.classList.remove('show');
        
        // Update current screen
